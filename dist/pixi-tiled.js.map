{"version":3,"file":"pixi-tiled.js","sourceRoot":"","sources":["../src/ContainerBuilder.ts","../src/PIXIDeclares.ts","../src/SpriteBuilder.ts","../src/TextBuilder.ts","../src/TildeMultiSheet.ts","../src/TiledContainer.ts","../src/TiledObjectParser.ts","../src/TiledPrimitives.ts","../src/Utils.ts","../src/index.ts"],"names":[],"mappings":";AAAA,IAAU,OAAO,CAmEhB;AAnED,WAAU,OAAO;IAAC,IAAA,gBAAgB,CAmEjC;IAnEiB,WAAA,gBAAgB;QACjC,SAAgB,SAAS,CAAC,IAAS,EAAE,MAAsB;YAE1D,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;YACxB,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC,EAAE,CAAC;YACzB,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,CAAC;YAC1C,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,IAAI,MAAM,CAAC,MAAM,CAAC;YAE7C,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC,IAAI,CAAC,QAAQ,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC;YAE3D,IAAG,IAAI,CAAC,CAAC;gBACR,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC;YACnB,IAAG,IAAI,CAAC,CAAC;gBACR,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC;YAEnB,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,IAAI,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC;YACjE,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YAErD,IAAM,IAAI,GAAG,QAAA,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;YAElC,MAAiC,CAAC,SAAS,GAAG,OAAO,CAAC,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;YAEvF,IAAI,IAAI,CAAC,UAAU,EAAE;gBACpB,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,IAAI,CAAC,CAAC;gBAE5C,MAAM,CAAC,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;aACvC;YAED,IAAI,OAAO,CAAC,MAAM,CAAC,eAAe,EAAE;gBACnC,UAAU,CAAC;oBACV,IAAM,IAAI,GAAG,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;oBAEjC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,QAAQ,EAAE,GAAG,CAAC;yBAC9B,QAAQ,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC;yBACrD,OAAO,EAAE,CAAC;oBACZ,IAAI,MAAM,YAAY,IAAI,CAAC,MAAM,EAAE;wBAClC,IAAI,CAAC,CAAC,IAAI,MAAM,CAAC,MAAM,CAAC;qBACxB;oBACD,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;gBAC9B,CAAC,EAAE,EAAE,CAAC,CAAC;aACP;QACF,CAAC;QAxCe,0BAAS,YAwCxB,CAAA;QAED,SAAgB,KAAK,CAAC,IAAS;YAC9B,IAAM,KAAK,GAAkB,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YAEnE,IAAI,SAAS,GAAG,SAAS,CAAC;YAE1B,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,EAAE;gBAC/B,SAAS,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;aAChD;iBAAM;gBACN,SAAS,GAAG,IAAI,OAAO,CAAC,cAAc,EAAE,CAAC;aACzC;YAED,IAAI,IAAI,CAAC,GAAG,EAAE;gBACb,IAAI,SAAS,YAAY,IAAI,CAAC,MAAM,EAAE;oBACrC,SAAS,CAAC,MAAM,GAAG,QAAA,MAAM,CAAC,eAAuC,CAAC;iBAClE;qBAAM;oBACN,SAAS,CAAC,KAAK,GAAG,QAAA,MAAM,CAAC,eAAuC,CAAC;oBACjE,SAAS,CAAC,OAAO,GAAG,IAAI,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;iBACtE;aACD;YAED,SAAS,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;YAE3B,OAAO,SAAS,CAAC;QAClB,CAAC;QAvBe,sBAAK,QAuBpB,CAAA;IACF,CAAC,EAnEiB,gBAAgB,GAAhB,wBAAgB,KAAhB,wBAAgB,QAmEjC;AAAD,CAAC,EAnES,OAAO,KAAP,OAAO,QAmEhB;AC1DD,IAAU,OAAO,CAEhB;AAFD,WAAU,OAAO;IACf,IAAY,CAAC,KAAK,GAAG,OAAO,CAAC;AAC/B,CAAC,EAFS,OAAO,KAAP,OAAO,QAEhB;ACXD,IAAU,OAAO,CAuChB;AAvCD,WAAU,OAAO;IAAC,IAAA,aAAa,CAuC9B;IAvCiB,WAAA,aAAa;QAC9B,SAAS,YAAY,CAAC,IAAS;YAE9B,IAAM,MAAM,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;YAGnD,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE;gBACzB,MAAM,CAAC,MAAM,GAAG,QAAA,MAAM,CAAC,eAAuC,CAAC;aAC/D;YAGD,QAAA,gBAAgB,CAAC,SAAS,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;YACzC,IAAM,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC;YACjC,IAAI,GAAG,EAAE;gBACP,MAAc,CAAC,SAAS,GAAG,QAAA,UAAU,CAAC,cAAc,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;aACtE;YAED,IAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC;YACpC,IAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC;YAEpC,IAAI,KAAK,EAAE;gBACV,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gBACrB,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC;aACpB;YAED,IAAI,KAAK,EAAE;gBACV,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;gBACrB,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC;aACpB;YAED,OAAO,MAAM,CAAC;QACf,CAAC;QAED,SAAgB,KAAK,CAAC,IAAS;YAE9B,IAAM,MAAM,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;YAElC,OAAO,MAAM,CAAC;QACf,CAAC;QALe,mBAAK,QAKpB,CAAA;IACF,CAAC,EAvCiB,aAAa,GAAb,qBAAa,KAAb,qBAAa,QAuC9B;AAAD,CAAC,EAvCS,OAAO,KAAP,OAAO,QAuChB;ACtCD,IAAU,OAAO,CAwGhB;AAxGD,WAAU,OAAO;IAAC,IAAA,WAAW,CAwG5B;IAxGiB,WAAA,WAAW;QAE5B,SAAS,UAAU,CAAC,MAAyB;YAE5C,IAAI,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,IAAI,CAA6B,CAAC;YAE9D,IAAI,IAAI,GAAG,GAAG,CAAC,YAAY,CAAC,CAAC,EAAC,CAAC,EAAC,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;YAE7D,KAAI,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,IAAE,CAAC,EAAE;gBAC1C,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,GAAG,CAAA,CAAC,CAAC,CAAC,CAAC;aAC3C;YACD,GAAG,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC,EAAC,CAAC,CAAC,CAAC;QAE7B,CAAC;QAED,SAAS,UAAU,CAAC,IAAS;YAC5B,IAAI,SAAS,GAAG,IAAI,QAAA,cAAc,EAAE,CAAC;YAErC,IAAI,QAAQ,GAAG,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE;gBAC5C,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI;gBACxB,aAAa,EAAE,IAAI,CAAC,KAAK;gBACzB,IAAI,EAAE,QAAA,KAAK,CAAC,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,QAAQ;gBAC1D,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,QAAQ;gBACnC,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,OAAO;gBAC3C,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,QAAQ;gBAC9C,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,QAAQ;gBACjD,QAAQ,EAAG,IAAI,CAAC,IAAI,CAAC,SAAS,IAAI,MAAM;aACxC,CAAC,CAAC;YAEH,QAAQ,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,GAAG,OAAO,CAAC;YAEpC,IAAG,QAAA,MAAM,CAAC,cAAc,EAAC;gBACxB,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE;oBAC/B,UAAU,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;oBAC5B,QAAQ,CAAC,OAAO,CAAC,WAAW,CAAC,MAAM,EAAE,CAAC;oBACtC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAA;gBACtB,CAAC,CAAC,CAAC;aACH;YAED,IAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC;YAC9B,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;YACrB,QAAA,gBAAgB,CAAC,SAAS,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;YACtC,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAEhC,QAAQ,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBACzB,KAAK,OAAO;oBACX;wBACC,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC;wBACtB,QAAQ,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC;qBACjC;oBACD,MAAM;gBACP,KAAK,QAAQ;oBACZ;wBACC,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,GAAG,CAAC;wBACxB,QAAQ,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;qBACvC;oBACD,MAAM;gBACP;oBACC;wBACC,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC;wBACtB,QAAQ,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;qBACxB;oBACD,MAAM;aACP;YAED,QAAQ,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;gBACzB,KAAK,QAAQ;oBACZ;wBACC,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC;wBACtB,QAAQ,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC;qBAClC;oBACD,MAAM;gBACP,KAAK,QAAQ;oBACZ;wBACC,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,GAAG,CAAC;wBACxB,QAAQ,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC;qBACxC;oBACD,MAAM;gBACP;oBACC;wBACC,QAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC;wBACtB,QAAQ,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;qBACxB;oBACD,MAAM;aACP;YAED,IAAI,KAAK,EAAE;gBACV,QAAQ,CAAC,KAAK,CAAC,MAAM,GAAG,QAAA,KAAK,CAAC,iBAAiB,CAAC,IAAI,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;gBAClF,QAAQ,CAAC,KAAK,CAAC,eAAe,GAAG,IAAI,CAAC,UAAU,CAAC,eAAe,IAAI,CAAC,CAAC;gBACtE,QAAQ,CAAC,KAAK,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,WAAW,IAAI,CAAC,CAAC;gBAC1D,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;aAC/B;YAID,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;YAC7B,SAAS,CAAC,IAAI,GAAG,QAAQ,CAAC;YAE1B,OAAO,SAAS,CAAC;QAClB,CAAC;QAED,SAAgB,KAAK,CAAC,IAAS;YAC9B,OAAO,UAAU,CAAC,IAAI,CAAC,CAAC;QACzB,CAAC;QAFe,iBAAK,QAEpB,CAAA;IACF,CAAC,EAxGiB,WAAW,GAAX,mBAAW,KAAX,mBAAW,QAwG5B;AAAD,CAAC,EAxGS,OAAO,KAAP,OAAO,QAwGhB;ACzGD,IAAU,KAAK,CA+Cd;AA/CD,WAAU,KAAK;IACd;QAKC,0BAAY,MAA2B;YAAvC,iBAMC;YATD,WAAM,GAAuB,EAAE,CAAC;YAChC,WAAM,GAAqC,EAAE,CAAC;YAG7C,IAAI,MAAM,EAAE;gBACX,MAAM,CAAC,OAAO,CAAC,UAAA,OAAO;oBACrB,KAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;gBACnB,CAAC,CAAC,CAAC;aACH;QACF,CAAC;QAED,8BAAG,GAAH,UAAI,KAAwB;YAE3B,IAAG,CAAC,KAAK;gBAAE,MAAM,0BAA0B,CAAC;YAE5C,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACzB,CAAC;QAED,qCAAU,GAAV,UAAW,GAAiB,EAAE,EAAU;YACvC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;QACvB,CAAC;QAED,sBAAI,sCAAQ;iBAAZ;gBACC,IAAI,GAAG,GAAqC,EAAE,CAAC;gBAE/C,KAAkB,UAAW,EAAX,KAAA,IAAI,CAAC,MAAM,EAAX,cAAW,EAAX,IAAW,EAAE;oBAA1B,IAAM,GAAG,SAAA;oBACb,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC,QAAQ,CAAC,CAAC;iBACjC;gBAED,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;gBAEhC,OAAO,GAAG,CAAC;YACZ,CAAC;;;WAAA;QAED,sBAAI,wCAAU;iBAAd;gBACC,IAAI,GAAG,GAAuC,EAAE,CAAC;gBAEjD,KAAkB,UAAW,EAAX,KAAA,IAAI,CAAC,MAAM,EAAX,cAAW,EAAX,IAAW,EAAE;oBAA1B,IAAM,GAAG,SAAA;oBACb,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC,UAAU,CAAC,CAAC;iBACnC;gBAED,OAAO,GAAG,CAAC;YACZ,CAAC;;;WAAA;QACF,uBAAC;IAAD,CAAC,AA7CD,IA6CC;IA7CY,sBAAgB,mBA6C5B,CAAA;AACF,CAAC,EA/CS,KAAK,KAAL,KAAK,QA+Cd;;;;;;;;;;;;;;AC/CD,IAAU,OAAO,CAQhB;AARD,WAAU,OAAO;IACb;QAAoC,kCAAc;QAAlD;YAAA,qEAMC;YALG,iBAAW,GAAW,CAAC,CAAC;YACxB,gBAAU,GAAW,CAAC,CAAC;;QAI3B,CAAC;QAAD,qBAAC;IAAD,CAAC,AAND,CAAoC,IAAI,CAAC,SAAS,GAMjD;IANY,sBAAc,iBAM1B,CAAA;AACL,CAAC,EARS,OAAO,KAAP,OAAO,QAQhB;ACDD,IAAU,OAAO,CAuShB;AAvSD,WAAU,OAAO;IAEhB,IAAI,SAAS,GAAY,IAAI,CAAC;IAC9B,SAAS,YAAY,CAAC,KAAU;QAE/B,IAAI,KAAK,GAAQ,EAAE,CAAC;QACpB,IAAI,KAAK,CAAC,UAAU,EAAE;YACrB,IAAI,KAAK,CAAC,UAAU,YAAY,KAAK,EAAE;gBACtC,KAAc,UAAgB,EAAhB,KAAA,KAAK,CAAC,UAAU,EAAhB,cAAgB,EAAhB,IAAgB,EAAE;oBAA3B,IAAI,CAAC,SAAA;oBACT,IAAI,GAAG,GAAG,CAAC,CAAC,KAAK,CAAC;oBAClB,IAAI,CAAC,CAAC,IAAI,IAAI,OAAO;wBAAE,GAAG,GAAG,QAAA,KAAK,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC;oBAE1D,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC;iBACpB;aACD;iBAAM;gBACN,KAAK,GAAG,KAAK,CAAC,UAAU,CAAC;aACzB;SACD;QAGD,IAAG,KAAK,CAAC,GAAG,EAAE;YAEb,IAAM,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC;YACtB,IAAM,KAAK,GAAG,GAAG,GAAG,UAAU,CAAC;YAC/B,IAAM,KAAK,GAAG,GAAG,GAAG,UAAU,CAAC;YAC/B,IAAM,KAAK,GAAG,GAAG,GAAG,UAAU,CAAC;YAE/B,KAAK,CAAC,OAAO,CAAC,GAAG,KAAK,CAAC;YACvB,KAAK,CAAC,OAAO,CAAC,GAAG,KAAK,CAAC;YACvB,KAAK,CAAC,OAAO,CAAC,GAAG,KAAK,CAAC;YAEvB,IAAM,OAAO,GAAG,GAAG,GAAG,CAAC,CAAE,CAAC,UAAU,GAAG,UAAU,GAAG,UAAU,CAAC,CAAC,CAAC;YACjE,KAAK,CAAC,GAAG,GAAG,OAAO,CAAC;SACpB;QAED,KAAK,CAAC,UAAU,GAAG,KAAK,CAAC;IAE1B,CAAC;IAED,SAAS,gBAAgB,CAAC,QAAe,EAAE,OAAe,EAAE,GAAW;QACtE,IAAI,OAAO,GAAG,SAAS,CAAC;QACxB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACzC,IAAI,QAAQ,CAAC,CAAC,CAAC,CAAC,QAAQ,IAAI,GAAG,EAAE;gBAChC,OAAO,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAC;aACtB;SACD;QAED,IAAI,CAAC,OAAO,EAAE;YACb,OAAO,CAAC,GAAG,CAAC,iBAAiB,GAAG,GAAG,GAAG,aAAa,CAAC,CAAC;YACrD,OAAO,IAAI,CAAC;SACZ;QAED,IAAM,OAAO,GAAG,GAAG,GAAG,OAAO,CAAC,QAAQ,CAAC;QAEvC,IAAI,IAAI,GAAI,OAAO,CAAC,KAA2C,CAAC,MAAM,CAAE,UAAC,GAAG,IAAK,OAAA,GAAG,CAAC,EAAE,IAAI,OAAO,EAAjB,CAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;QAEvG,IAAI,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;QAClC,IAAI,CAAC,GAAG,EAAE;YACT,OAAO,CAAC,GAAG,CAAC,sBAAsB,GAAG,OAAO,CAAC,CAAC;YAC9C,OAAO,IAAI,CAAC;SACZ;QAED,GAAG,CAAC,KAAK,GAAG,OAAO,GAAG,GAAG,CAAC,KAAK,CAAC;QAEhC,OAAO,GAAG,CAAC;IACZ,CAAC;IAED,SAAgB,WAAW,CAC1B,GAAoE,EACpE,MAAW;QAEX,IAAI,KAAK,GAAQ,EAAE,CAAC;QAEpB,IAAI,GAAG,YAAY,IAAI,CAAC,cAAc,EAAE;YACvC,KAAK,GAAG,GAAG,CAAC,IAAI,CAAC;SACjB;aAAM;YACN,KAAK,GAAG,MAAM,CAAC;SACf;QAED,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,IAAI,IAAI,KAAK,EAAE;YAElC,OAAO,SAAS,CAAC;SACjB;QAED,IAAI,SAAS,EAAE;YACd,OAAO,CAAC,GAAG,CAAC,0DAA0D,CAAC,CAAC;YACxE,SAAS,GAAG,KAAK,CAAC;SAClB;QAED,IAAM,UAAU,GACf,QAAA,MAAM,CAAC,cAAc,IAAI,SAAS,IAAI,QAAA,MAAM,CAAC,cAAc,IAAK,IAAY,CAAC,OAAO,IAAI,SAAS,CAAC;QAEnG,IAAI,KAAK,GAAG,UAAU,CAAC,CAAC,CAAE,IAAY,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;QAC1D,IAAI,KAAK,GAAG,UAAU,CAAC,CAAC,CAAE,IAAY,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;QAC1D,IAAI,KAAK,GAAG,UAAU,CAAC,CAAC,CAAE,IAAY,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;QAE1D,IAAM,MAAM,GAAG,IAAI,QAAA,cAAc,EAAE,CAAC;QAEpC,IAAM,QAAQ,GAAG,IAAI,MAAM,CAAC,WAAW,CAAC,CAAC;QAEzC,MAAM,CAAC,WAAW,GAAG,KAAK,CAAC,MAAM,CAAC;QAClC,MAAM,CAAC,UAAU,GAAG,KAAK,CAAC,KAAK,CAAC;QAEhC,IAAI,OAAO,GAAG,EAAE,CAAC;QAEjB,IAAI,GAAG,YAAY,IAAI,CAAC,cAAc,EACtC;YACC,MAAM,CAAC,IAAI,GAAG,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,EAAC,EAAE,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;YAEzD,OAAO,GAAG,GAAG,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;YAC9C,OAAO,GAAG,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAE,CAAC,CAAC,CAAC,CAAC;SACtC;QAED,IAAI,KAAK,CAAC,MAAM,EAAE;YACjB,IAAI,MAAM,GAAG,CAAC,CAAC;YAEf,IAAI,UAAU;gBAAE,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;YAEtD,KAAkB,UAAY,EAAZ,KAAA,KAAK,CAAC,MAAM,EAAZ,cAAY,EAAZ,IAAY,EAAE;gBAA3B,IAAI,KAAK,SAAA;gBACb,IAAI,KAAK,CAAC,IAAI,KAAK,aAAa,IAAI,KAAK,CAAC,IAAI,KAAK,YAAY,EAAE;oBAChE,OAAO,CAAC,IAAI,CAAC,+CAA+C,CAAC,CAAC;oBAC9D,SAAS;iBACT;gBAED,YAAY,CAAC,KAAK,CAAC,CAAC;gBACpB,IAAM,KAAK,GAAG,KAAK,CAAC,UAAU,CAAC;gBAE/B,IAAI,KAAK,CAAC,MAAM,IAAI,KAAK,CAAC,UAAU,EAAE;oBACrC,OAAO,CAAC,GAAG,CAAC,iCAAiC,GAAG,KAAK,CAAC,IAAI,CAAC,CAAC;oBAC5D,SAAS;iBACT;gBAED,IAAM,SAAS,GAAG,UAAU;oBAC3B,CAAC,CAAC,IAAI,KAAK,CAAC,IAAI,KAAK,CAAC,KAAK,CAAC,MAAM,KAAK,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;oBAChF,CAAC,CAAC,IAAI,QAAA,cAAc,EAAE,CAAC;gBAExB,MAAM,EAAE,CAAC;gBAET,SAAS,CAAC,OAAO,GAAG,KAAK,CAAC,EAAE,CAAC;gBAE7B,SAAS,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,CAAC;gBAC3B,MAAc,CAAC,MAAM,GAAG,EAAE,CAAC;gBAC3B,MAAc,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,GAAG,SAAS,CAAC;gBAC/C,SAAS,CAAC,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC;gBAElC,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;gBACzC,SAAS,CAAC,KAAK,GAAG,KAAK,CAAC,OAAO,IAAI,CAAC,CAAC;gBAGrC,QAAA,gBAAgB,CAAC,SAAS,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;gBAE7C,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;gBAE3B,IAAI,KAAK,CAAC,IAAI,IAAI,YAAY,EAAE;oBAC/B,KAAK,CAAC,OAAO,GAAG;wBACf;4BACC,GAAG,EAAE;gCACJ,KAAK,EAAE,OAAO,GAAG,KAAK,CAAC,KAAK;6BAC5B;4BACD,GAAG,EAAE,SAAS;4BACd,IAAI,EAAE,KAAK,CAAC,IAAI;4BAChB,CAAC,EAAE,KAAK,CAAC,CAAC,GAAG,KAAK,CAAC,OAAO;4BAC1B,CAAC,EAAE,KAAK,CAAC,CAAC,GAAG,KAAK,CAAC,OAAO;4BAC1B,cAAc,EAAE,IAAI;4BACpB,UAAU,EAAE,KAAK,CAAC,UAAU;yBAC5B;qBACD,CAAC;iBACF;gBAED,IAAI,CAAC,KAAK,CAAC,OAAO;oBAAE,OAAO,SAAS,CAAC;gBAGrC,IAAI,WAAW,GAAG,CAAC,CAAC;wCACX,QAAQ;oBAChB,YAAY,CAAC,QAAQ,CAAC,CAAC;oBAEvB,IAAI,QAAQ,CAAC,UAAU,CAAC,MAAM;0CAAW;oBAEzC,IAAM,IAAI,GAAG,QAAA,KAAK,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;oBACvC,IAAI,UAAU,GAAG,IAAI,CAAC;oBACtB,QAAQ,IAAI,EAAE;wBACb,KAAK,QAAA,KAAK,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;4BACjC,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE;gCAC7B,IAAM,GAAG,GAAG,gBAAgB,CAAC,KAAK,CAAC,QAAQ,EAAE,OAAO,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC;gCACpE,IAAI,CAAC,GAAG,EAAE;;iCAET;gCACD,QAAQ,CAAC,GAAG,GAAG,GAAG,CAAC;6BACnB;4BAGD,UAAU,GAAG,QAAA,aAAa,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;4BAE3C,IAAI,QAAM,GAAgB,UAAyB,CAAC;4BAEpD,IAAI,QAAM,GAAmD,SAAS,CAAC;4BAEvE,IAAI,MAAM,YAAY,IAAI,CAAC,MAAM,EAAE;gCAClC,QAAM,GAAG,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;6BAC9C;iCAAM,IAAI,GAAG,YAAY,IAAI,CAAC,WAAW,EAAE;gCAC3C,QAAM,GAAG,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;6BAC1C;4BAED,IAAI,CAAC,QAAM,EAAE;gCACZ,IAAI,MAAM,YAAY,IAAI,CAAC,MAAM,EAAE;oCAElC,MAAM,CAAC,GAAG,CACT,QAAQ,CAAC,GAAG,CAAC,KAAK,EAClB;wCACC,cAAc,EAAE,GAAG;qCACnB,EACD;wCACC,IAAM,GAAG,GAAG,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC;wCACzD,QAAM,CAAC,OAAO,GAAG,GAAG,CAAC;wCACrB,IAAI,QAAQ,CAAC,cAAc,EAAE;4CAC5B,QAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;yCACpB;oCACF,CAAC,CACD,CAAC;iCACF;qCAAM;;iCAEN;6BACD;iCAAM;gCACN,IAAI,QAAM,YAAY,IAAI,CAAC,cAAc,EAAE;oCAC1C,IAAI,CAAC,QAAM,CAAC,UAAU,EAAE;wCACtB,QAAc,CAAC,iBAAiB,CAAC,IAAI,CAAC,UAAC,CAAK;4CAC5C,QAAM,CAAC,OAAO,GAAI,QAAc,CAAC,OAAO,CAAC;4CACzC,IAAI,QAAQ,CAAC,cAAc,EAAE;gDAC5B,QAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;6CACpB;wCACF,CAAC,CAAC,CAAA;qCACF;yCAAM;wCACN,QAAM,CAAC,OAAO,GAAG,QAAM,CAAC,OAAO,CAAC;wCAChC,IAAI,QAAQ,CAAC,cAAc,EAAE;4CAC5B,QAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;yCACpB;qCACD;iCACD;qCAAM,IAAI,QAAsB,EAAE;oCAClC,QAAM,CAAC,OAAO,GAAG,QAAa,CAAC;oCAG/B,IAAI,QAAQ,CAAC,cAAc,EAAE;wCAC5B,QAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;qCACpB;iCACD;6BACD;4BAED,MAAM;yBACN;wBAGD,KAAK,QAAA,KAAK,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;4BAChC,UAAU,GAAG,QAAA,WAAW,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;4BACzC,MAAM;yBACN;wBAED,OAAO,CAAC,CAAC;4BACR,UAAU,GAAG,QAAA,gBAAgB,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;yBAC9C;qBACD;oBAED,IAAI,QAAA,MAAM,CAAC,cAAc,EAAE;wBACzB,UAAkB,CAAC,WAAW,GAAG,SAAS,CAAC,KAAK,CAAC;wBAClD,MAAM,CAAC,UAAU,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC;qBAC3C;yBAAM;wBACN,SAAS,CAAC,UAAU,CAAC,UAAU,EAAE,WAAW,CAAC,CAAC;qBAC9C;oBAED,WAAW,EAAE,CAAC;;gBA/Ff,KAAqB,UAAa,EAAb,KAAA,KAAK,CAAC,OAAO,EAAb,cAAa,EAAb,IAAa;oBAA7B,IAAI,QAAQ,SAAA;4BAAR,QAAQ;iBAgGhB;aACD;SACD;QAED,OAAO,MAAM,CAAC;IACf,CAAC;IA/Me,mBAAW,cA+M1B,CAAA;IAGU,cAAM,GAAG;QAEnB,KAAK,YAAC,GAAwB,EAAE,IAAc;YAE7C,IAAI,KAAK,GAAG,WAAW,CAAC,GAAG,EAAE,IAAW,CAAC,CAAC;YAC1C,GAAG,CAAC,KAAK,GAAG,KAAK,CAAC;YAClB,IAAI,EAAE,CAAC;QACR,CAAC;QAED,GAAG,YAAC,GAAwB,EAAE,IAAc;YAC1C,QAAA,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,GAAG,EAAE,IAAI,CAAC,CAAC;QACrC,CAAC;QAED,GAAG;YACF,OAAO,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;QACnC,CAAC;KAED,CAAA;AACF,CAAC,EAvSS,OAAO,KAAP,OAAO,QAuShB;AC9SA,IAAU,OAAO,CAsLjB;AAtLA,WAAU,OAAO;IAAC,IAAA,UAAU,CAsL5B;IAtLkB,WAAA,UAAU;QAO5B;YAA+B,6BAAc;YAA7C;gBAAA,qEAIC;gBAHA,UAAI,GAAW,EAAE,CAAC;gBAClB,WAAK,GAAa,EAAE,CAAC;gBACrB,aAAO,GAAY,IAAI,CAAC;;YACzB,CAAC;YAAD,gBAAC;QAAD,CAAC,AAJD,CAA+B,IAAI,CAAC,SAAS,GAI5C;QAJY,oBAAS,YAIrB,CAAA;QAED;YAAgC,8BAAU;YAKzC,oBAAY,CAAU,EAAE,CAAU;gBAAlC,YACC,kBAAM,CAAC,EAAE,CAAC,CAAC,SACX;gBAND,UAAI,GAAW,EAAE,CAAC;gBAClB,WAAK,GAAa,EAAE,CAAC;gBACrB,aAAO,GAAY,IAAI,CAAC;;YAIxB,CAAC;YACF,iBAAC;QAAD,CAAC,AARD,CAAgC,IAAI,CAAC,KAAK,GAQzC;QARY,qBAAU,aAQtB,CAAA;QAED;YAAkC,gCAAY;YAO7C,sBAAY,MAAoB;gBAAhC,YACC,kBAAM,MAAM,CAAC,SACb;gBARD,UAAI,GAAW,EAAE,CAAC;gBAClB,WAAK,GAAa,EAAE,CAAC;gBACrB,aAAO,GAAY,IAAI,CAAC;gBAChB,QAAE,GAAW,CAAC,CAAC;gBACf,QAAE,GAAW,CAAC,CAAC;;YAIvB,CAAC;YAED,sBAAI,2BAAC;qBAoBL;oBACC,OAAO,IAAI,CAAC,EAAE,CAAC;gBAChB,CAAC;qBAtBD,UAAM,EAAU;oBAEf,IAAM,KAAK,GAAG,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC;oBAC3B,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;oBAEb,KAAK,IAAI,MAAM,GAAG,CAAC,EAAE,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,MAAM,IAAI,CAAC,EAAE;wBAC9D,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC;qBAC7B;gBACF,CAAC;;;eAAA;YAED,sBAAI,2BAAC;qBAcL;oBACC,OAAO,IAAI,CAAC,EAAE,CAAC;gBAChB,CAAC;qBAhBD,UAAM,EAAU;oBAEf,IAAM,KAAK,GAAG,EAAE,GAAG,IAAI,CAAC,EAAE,CAAC;oBAC3B,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;oBAEb,KAAK,IAAI,MAAM,GAAG,CAAC,EAAE,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,MAAM,IAAI,CAAC,EAAE;wBAC9D,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,KAAK,CAAC;qBAC7B;gBACF,CAAC;;;eAAA;YAUD,gCAAS,GAAT;gBACC,IAAI,IAAI,GAAG,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;gBAEhC,IAAI,IAAI,GAAW,IAAI,CAAC,EAAE,CAAC;gBAC3B,IAAI,IAAI,GAAW,IAAI,CAAC,EAAE,CAAC;gBAE3B,KAAK,IAAI,KAAK,GAAG,CAAC,EAAE,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,KAAK,IAAI,CAAC,EAAE;oBAC3D,IAAM,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;oBAC9B,IAAM,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;oBAElC,IAAI,CAAC,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAA,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;oBAClC,IAAI,CAAC,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAA,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;oBAElC,IAAI,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,EAAE,CAAA,CAAC,CAAC,IAAI,CAAC;oBAC5B,IAAI,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;iBAC7B;gBAED,IAAI,CAAC,KAAK,GAAG,IAAI,GAAI,IAAI,CAAC,CAAC,CAAC;gBAC5B,IAAI,CAAC,MAAM,GAAG,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC;gBAE5B,OAAO,IAAI,CAAC;YACb,CAAC;YAED,sBAAI,+BAAK;qBAAT;oBACC,OAAO,IAAI,CAAC,SAAS,EAAE,CAAC,KAAK,CAAC;gBAC/B,CAAC;qBAiBD,UAAU,CAAS;oBAClB,IAAM,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC;oBAE9B,KAAK,IAAI,MAAM,GAAG,CAAC,EAAE,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,MAAM,IAAI,CAAC,EAAE;wBAE9D,IAAM,KAAK,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC;wBACvD,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,KAAK,CAAC;qBACtC;gBACF,CAAC;;;eAzBA;YAED,sBAAI,gCAAM;qBAAV;oBACC,OAAO,IAAI,CAAC,SAAS,EAAE,CAAC,MAAM,CAAC;gBAChC,CAAC;qBAED,UAAW,CAAS;oBACnB,IAAM,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC;oBAE/B,KAAK,IAAI,MAAM,GAAG,CAAC,EAAE,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,MAAM,IAAI,CAAC,EAAE;wBAE9D,IAAM,KAAK,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC;wBACvD,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,KAAK,CAAC;wBAAA,CAAC;qBACvC;gBAEF,CAAC;;;eAXA;YAuBF,mBAAC;QAAD,CAAC,AA3FD,CAAkC,IAAI,CAAC,OAAO,GA2F7C;QA3FY,uBAAY,eA2FxB,CAAA;QAED;YAOC,uBAAY,MAAyB;gBANrC,SAAI,GAAW,EAAE,CAAC;gBAClB,UAAK,GAAa,EAAE,CAAC;gBACrB,YAAO,GAAY,IAAI,CAAC;gBAExB,WAAM,GAAsB,EAAE,CAAC;gBAG9B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,KAAK,EAAE,CAAC;YAC9B,CAAC;YACF,oBAAC;QAAD,CAAC,AAVD,IAUC;QAVY,wBAAa,gBAUzB,CAAA;QAED;YAAkC,gCAAY;YAK7C,sBAAY,CAAU,EAAE,CAAU,EAAE,EAAW,EAAE,EAAW;gBAA5D,YACC,kBAAM,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC,SACnB;gBAND,UAAI,GAAW,EAAE,CAAC;gBAClB,WAAK,GAAa,EAAE,CAAC;gBACrB,aAAO,GAAY,IAAI,CAAC;;YAIxB,CAAC;YACF,mBAAC;QAAD,CAAC,AARD,CAAkC,IAAI,CAAC,OAAO,GAQ7C;QARY,uBAAY,eAQxB,CAAA;QAED,SAAgB,cAAc,CAAC,IAAS;YACvC,IAAG,CAAC,IAAI;gBAAE,OAAO;YAEjB,IAAI,IAAI,GAAgC,SAAS,CAAC;YAElD,IAAI,IAAI,GAA0B,QAAA,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;YAExD,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC;YACrB,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC;YAErB,QAAQ,IAAI,EAAE;gBACb,KAAK,QAAA,KAAK,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;oBACnC,IAAI,GAAG,IAAI,YAAY,CACtB,IAAI,CAAC,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,KAAK,EACzB,IAAI,CAAC,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,MAAM,EAC1B,IAAI,CAAC,KAAK,GAAG,GAAG,EAChB,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC,CAAC;oBAEpB,MAAM;iBACN;gBACD,KAAK,QAAA,KAAK,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC;oBACnC,IAAI,MAAM,GAAG,IAAI,CAAC,OAA0C,CAAC;oBAC7D,IAAI,KAAK,GAAG,MAAM,CAAC,GAAG,CAAC,UAAA,CAAC;wBACvB,OAAO,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;oBACnD,CAAC,CAAC,CAAC;oBACH,IAAI,GAAG,IAAI,YAAY,CAAC,KAAK,CAAC,CAAC;oBAC/B,MAAM;iBACN;gBACD,KAAK,QAAA,KAAK,CAAC,eAAe,CAAC,QAAQ,CAAC,CAAC;oBACpC,IAAI,MAAM,GAAG,IAAI,CAAC,OAA0C,CAAC;oBAC7D,IAAI,KAAK,GAAG,MAAM,CAAC,GAAG,CAAC,UAAA,CAAC;wBACvB,OAAO,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;oBACnD,CAAC,CAAC,CAAC;oBACH,IAAI,GAAG,IAAI,aAAa,CAAC,KAAK,CAAC,CAAC;oBAChC,MAAM;iBACN;gBACD;oBACC,IAAI,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;aAC/D;YACD,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;YACnD,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;YAC5B,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC;YACtB,OAAO,IAAI,CAAC;QACb,CAAC;QA3Ce,yBAAc,iBA2C7B,CAAA;IACF,CAAC,EAtLkB,UAAU,GAAV,kBAAU,KAAV,kBAAU,QAsL5B;AAAD,CAAC,EAtLU,OAAO,KAAP,OAAO,QAsLjB;ACtLD,IAAU,OAAO,CAuDhB;AAvDD,WAAU,OAAO;IAAC,IAAA,KAAK,CAuDtB;IAvDiB,WAAA,KAAK;QACtB,SAAgB,iBAAiB,CAAC,KAAsB;YACvD,IAAI,CAAC,KAAK;gBAAE,OAAO,CAAC,CAAC;YAErB,IAAI,OAAO,KAAK,IAAI,QAAQ;gBAAE,OAAO,KAAK,CAAC;YAE3C,KAAK,GAAG,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAEnE,IAAI;gBACH,OAAO,QAAQ,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;aAC3B;YAAC,OAAO,CAAC,EAAE;gBACX,OAAO,CAAC,IAAI,CAAC,oBAAoB,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC;gBAC9C,OAAO,CAAC,CAAC;aACT;QACF,CAAC;QAbe,uBAAiB,oBAahC,CAAA;QAED,SAAgB,gBAAgB,CAAC,KAAsB;YACtD,IAAI,CAAC,KAAK;gBAAE,OAAO,CAAC,CAAC;YACrB,IAAI,OAAO,KAAK,IAAI,QAAQ;gBAAE,OAAO,KAAK,CAAC;YAE3C,IAAI,KAAK,CAAC,MAAM,IAAI,CAAC;gBAAE,OAAO,CAAC,CAAC;YAEhC,IAAI;gBACH,OAAO,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,KAAK,CAAC;aAChD;YAAC,OAAO,CAAC,EAAE;gBACX,OAAO,CAAC,IAAI,CAAC,oBAAoB,EAAE,CAAC,CAAC,OAAO,CAAC,CAAC;gBAC9C,OAAO,CAAC,CAAC;aACT;QACF,CAAC;QAZe,sBAAgB,mBAY/B,CAAA;QAED,IAAY,eAQX;QARD,WAAY,eAAe;YAC1B,2DAAO,CAAA;YACP,uDAAK,CAAA;YACL,2DAAO,CAAA;YACP,6DAAQ,CAAA;YACR,2DAAO,CAAA;YACP,qDAAI,CAAA;YACJ,uDAAK,CAAA;QACN,CAAC,EARW,eAAe,GAAf,qBAAe,KAAf,qBAAe,QAQ1B;QAID,SAAgB,SAAS,CAAC,IAAS;YAElC,IAAG,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,UAAU,CAAC,SAAS;gBAAE,OAAO,eAAe,CAAC,OAAO,CAAC;YAChF,IAAI,IAAI,CAAC,GAAG,IAAI,IAAI,CAAC,KAAK;gBAAE,OAAO,eAAe,CAAC,KAAK,CAAC;YACzD,IAAI,IAAI,CAAC,IAAI,IAAI,SAAS;gBAAE,OAAO,eAAe,CAAC,IAAI,CAAC;YACxD,IAAI,IAAI,CAAC,KAAK;gBAAE,OAAO,eAAe,CAAC,KAAK,CAAC;YAC7C,IAAI,IAAI,CAAC,OAAO;gBAAE,OAAO,eAAe,CAAC,OAAO,CAAC;YACjD,IAAI,IAAI,CAAC,QAAQ;gBAAE,OAAO,eAAe,CAAC,QAAQ,CAAC;YACnD,IAAI,IAAI,CAAC,OAAO;gBAAE,OAAO,eAAe,CAAC,OAAO,CAAC;YAEjD,OAAO,eAAe,CAAC,OAAO,CAAC;QAChC,CAAC;QAXe,eAAS,YAWxB,CAAA;IAEF,CAAC,EAvDiB,KAAK,GAAL,aAAK,KAAL,aAAK,QAuDtB;AAAD,CAAC,EAvDS,OAAO,KAAP,OAAO,QAuDhB;ACvDD,IAAU,OAAO,CAuChB;AAvCD,WAAU,OAAO;IACL,cAAM,GAAgB;QAChC,eAAe,EAAE,IAAI,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;QACrC,eAAe,EAAE,KAAK;QACtB,cAAc,EAAE,KAAK;QACrB,cAAc,EAAE,KAAK;KACrB,CAAC;IAES,gBAAQ,GAAoB;QACtC,QAAA,gBAAgB,CAAC,KAAK;QACtB,QAAA,aAAa,CAAC,KAAK;QACnB,QAAA,WAAW,CAAC,KAAK;KACjB,CAAC;IASF,SAAgB,YAAY,CAAC,KAA0C;QAA1C,sBAAA,EAAA,iBAA0C;QACtE,IAAI,KAAK,EAAE;YACV,QAAA,MAAM,CAAC,eAAe,GAAG,KAAK,CAAC,eAAe,IAAI,QAAA,MAAM,CAAC,eAAe,CAAC;YACzE,QAAA,MAAM,CAAC,eAAe,GAAG,KAAK,CAAC,eAAe,IAAI,SAAS;gBACrD,CAAC,CAAC,KAAK,CAAC,eAAe;gBACvB,CAAC,CAAC,QAAA,MAAM,CAAC,eAAe,CAAC;YAE/B,QAAA,MAAM,CAAC,cAAc,GAAG,KAAK,CAAC,cAAc,IAAI,SAAS;gBACnD,CAAC,CAAC,KAAK,CAAC,cAAc;gBACtB,CAAC,CAAC,QAAA,MAAM,CAAC,cAAc,CAAC;YAE9B,QAAA,MAAM,CAAC,cAAc,GAAG,KAAK,CAAC,cAAc,IAAI,SAAS;gBACnD,CAAC,CAAC,KAAK,CAAC,cAAc;gBACtB,CAAC,CAAC,QAAA,MAAM,CAAC,cAAc,CAAC;SAC9B;QAED,IAAI,CAAC,MAAM,CAAC,cAAc,CAAE,QAAA,MAAM,CAAC,CAAC;IACrC,CAAC;IAjBe,oBAAY,eAiB3B,CAAA;AACF,CAAC,EAvCS,OAAO,KAAP,OAAO,QAuChB","sourcesContent":["namespace TiledOG.ContainerBuilder {\r\n\texport function ApplyMeta(meta: any, target: PIXI.Container) {\r\n\t\t\r\n\t\ttarget.name = meta.name;\r\n\t\ttarget.tiledId = meta.id;\r\n\t\ttarget.width = meta.width || target.width;\r\n\t\ttarget.height = meta.height || target.height;\r\n\r\n\t\ttarget.rotation = ((meta.rotation || 0) * Math.PI) / 180.0;\r\n\r\n\t\tif(meta.x)\r\n\t\t\ttarget.x = meta.x;\r\n\t\tif(meta.y)\r\n\t\t\ttarget.y = meta.y;\r\n\t\t\r\n\t\ttarget.visible = meta.visible == undefined ? true : meta.visible;\r\n\t\ttarget.types = meta.type ? meta.type.split(\":\") : [];\r\n\r\n\t\tconst type = Utils.Objectype(meta);\r\n\r\n\t\t(target as TiledOG.TiledContainer).primitive = TiledOG.Primitives.BuildPrimitive(meta);\r\n\r\n\t\tif (meta.properties) {\r\n\t\t\ttarget.alpha = meta.properties.opacity || 1;\r\n\t\t\t//@ts-ignore\r\n\t\t\tObject.assign(target, meta.properties);\r\n\t\t}\r\n\r\n\t\tif (TiledOG.Config.debugContainers) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tconst rect = new PIXI.Graphics();\r\n\r\n\t\t\t\trect.lineStyle(2, 0xff0000, 0.7)\r\n\t\t\t\t\t.drawRect(target.x, target.y, meta.width, meta.height)\r\n\t\t\t\t\t.endFill();\r\n\t\t\t\tif (target instanceof PIXI.Sprite) {\r\n\t\t\t\t\trect.y -= target.height;\r\n\t\t\t\t}\r\n\t\t\t\ttarget.parent.addChild(rect);\r\n\t\t\t}, 30);\r\n\t\t}\r\n\t}\r\n\r\n\texport function Build(meta: any): PIXI.DisplayObject {\r\n\t\tconst types: Array<string> = meta.type ? meta.type.split(\":\") : [];\r\n\r\n\t\tlet container = undefined; // new TiledOG.TiledContainer();\r\n\r\n\t\tif (types.indexOf(\"mask\") > -1) {\r\n\t\t\tcontainer = new PIXI.Sprite(PIXI.Texture.WHITE);\r\n\t\t} else {\r\n\t\t\tcontainer = new TiledOG.TiledContainer();\r\n\t\t}\r\n\r\n\t\tif (meta.gid) {\r\n\t\t\tif (container instanceof PIXI.Sprite) {\r\n\t\t\t\tcontainer.anchor = Config.defSpriteAnchor as PIXI.ObservablePoint;\r\n\t\t\t} else {\r\n\t\t\t\tcontainer.pivot = Config.defSpriteAnchor as PIXI.ObservablePoint;\r\n\t\t\t\tcontainer.hitArea = new PIXI.Rectangle(0, 0, meta.width, meta.height);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tApplyMeta(meta, container);\r\n\r\n\t\treturn container;\r\n\t}\r\n}\r\n","///<reference types=\"pixi.js\"/>\r\n\r\ndeclare module PIXI {\r\n\texport interface Container {\r\n\t\ttypes?: ArrayLike<string>;\r\n\t\ttiledId?: number;\r\n\t}\r\n}\r\n\r\nnamespace TiledOG {\r\n\t(PIXI as any).tiled = TiledOG;\r\n}\r\n","namespace TiledOG.SpriteBuilder {\r\n\tfunction сreateSprite(meta: any): PIXI.Sprite {\r\n\t\t// TODO make load from texture atlass\r\n\t\tconst sprite = new PIXI.Sprite(PIXI.Texture.EMPTY);\r\n\r\n\t\t//TODO Set anchor and offsets to center (.5, .5)\r\n\t\tif (!meta.fromImageLayer) {\r\n\t\t\tsprite.anchor = Config.defSpriteAnchor as PIXI.ObservablePoint;\r\n\t\t}\r\n\r\n\t\t//debugger\r\n\t\tContainerBuilder.ApplyMeta(meta, sprite);\r\n\t\tconst obj = meta.img.objectgroup;\r\n\t\tif (obj) {\r\n\t\t\t(sprite as any).primitive = Primitives.BuildPrimitive(obj.objects[0]);\r\n\t\t}\r\n\r\n\t\tconst hFlip = meta.properties.hFlip;\r\n\t\tconst vFlip = meta.properties.vFlip;\r\n\r\n\t\tif (hFlip) {\r\n\t\t\tsprite.scale.x *= -1;\r\n\t\t\tsprite.anchor.x = 1;\r\n\t\t}\r\n\r\n\t\tif (vFlip) {\r\n\t\t\tsprite.scale.y *= -1;\r\n\t\t\tsprite.anchor.y = 0;\r\n\t\t}\r\n\r\n\t\treturn sprite;\r\n\t}\r\n\r\n\texport function Build(meta: any): PIXI.DisplayObject {\r\n\t\t//debugger\r\n\t\tconst sprite = сreateSprite(meta);\r\n\r\n\t\treturn sprite;\r\n\t}\r\n}\r\n","\r\nnamespace TiledOG.TextBuilder {\r\n\t\r\n\tfunction roundAlpha(canvas: HTMLCanvasElement) {\r\n\r\n\t\tlet ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n\t\tlet data = ctx.getImageData(0,0,canvas.width, canvas.height);\r\n\r\n\t\tfor(let i = 3; i < data.data.length; i+=4) {\r\n\t\t\tdata.data[i] = data.data[i] > 200 ? 255: 0; \r\n\t\t}\r\n\t\tctx.putImageData(data, 0,0);\r\n\t\r\n\t}\r\n\r\n\tfunction createText(meta: any): TiledContainer {\r\n\t\tlet container = new TiledContainer();\r\n\t\r\n\t\tlet pixiText = new PIXI.Text(meta.text.text, {\r\n\t\t\twordWrap: meta.text.wrap,\r\n\t\t\twordWrapWidth: meta.width,\r\n\t\t\tfill: Utils.HexStringToHexInt(meta.text.color) || 0x000000,\r\n\t\t\talign: meta.text.valign || \"center\",\r\n\t\t\tfontFamily: meta.text.fontfamily || \"Arial\",\r\n\t\t\tfontWeight: meta.text.bold ? \"bold\" : \"normal\",\r\n\t\t\tfontStyle: meta.text.italic ? \"italic\" : \"normal\",\r\n\t\t\tfontSize : meta.text.pixelsize || \"16px\"\r\n\t\t});\r\n\r\n\t\tpixiText.name = meta.name + \"_Text\";\r\n\r\n\t\tif(Config.roundFontAlpha){\r\n\t\t\tpixiText.texture.once(\"update\", () =>{\r\n\t\t\t\troundAlpha(pixiText.canvas);\r\n\t\t\t\tpixiText.texture.baseTexture.update();\r\n\t\t\t\tconsole.log(\"update\")\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst props = meta.properties;\r\n\t\tmeta.properties = {};\r\n\t\tContainerBuilder.ApplyMeta(meta, container);\r\n        container.pivot.set(0, 0);\r\n\t\t\r\n\t\tswitch (meta.text.halign) {\r\n\t\t\tcase \"right\":\r\n\t\t\t\t{\r\n\t\t\t\t\tpixiText.anchor.x = 1;\r\n\t\t\t\t\tpixiText.position.x = meta.width;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"center\":\r\n\t\t\t\t{\r\n\t\t\t\t\tpixiText.anchor.x = 0.5;\r\n\t\t\t\t\tpixiText.position.x = meta.width * 0.5;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\t{\r\n\t\t\t\t\tpixiText.anchor.x = 0;\r\n\t\t\t\t\tpixiText.position.x = 0;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tswitch (meta.text.valign) {\r\n\t\t\tcase \"bottom\":\r\n\t\t\t\t{\r\n\t\t\t\t\tpixiText.anchor.y = 1;\r\n\t\t\t\t\tpixiText.position.y = meta.height;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"center\":\r\n\t\t\t\t{\r\n\t\t\t\t\tpixiText.anchor.y = 0.5;\r\n\t\t\t\t\tpixiText.position.y = meta.height * 0.5;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\t{\r\n\t\t\t\t\tpixiText.anchor.y = 0;\r\n\t\t\t\t\tpixiText.position.y = 0;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (props) {\r\n\t\t\tpixiText.style.stroke = Utils.HexStringToHexInt(meta.properties.strokeColor) || 0;\r\n\t\t\tpixiText.style.strokeThickness = meta.properties.strokeThickness || 0;\r\n\t\t\tpixiText.style.padding = meta.properties.fontPadding || 0;\r\n\t\t\tObject.assign(pixiText, props);\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t//_cont.parentGroup = _layer.group;\r\n\t\tcontainer.addChild(pixiText);\r\n\t\tcontainer.text = pixiText;\r\n\r\n\t\treturn container;\r\n\t}\r\n\r\n\texport function Build(meta: any) : PIXI.DisplayObject {\r\n\t\treturn createText(meta);\r\n\t}\r\n}\r\n","namespace Tiled {\r\n\texport class MultiSpritesheet {\r\n\r\n\t\tsheets: PIXI.Spritesheet[] = [];\r\n\t\timages: { [name: string]: PIXI.Texture } = {};\r\n\r\n\t\tconstructor(sheets?: PIXI.Spritesheet[]) {\r\n\t\t\tif (sheets) {\r\n\t\t\t\tsheets.forEach(element => {\r\n\t\t\t\t\tthis.add(element);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tadd(sheet?: PIXI.Spritesheet) {\r\n\t\t\t\r\n\t\t\tif(!sheet) throw \"Sheet can't be undefined\";\r\n\r\n\t\t\tthis.sheets.push(sheet);\r\n\t\t}\r\n\r\n\t\taddTexture(tex: PIXI.Texture, id: string) {\r\n\t\t\tthis.images[id] = tex;\r\n\t\t}\r\n\r\n\t\tget textures(): { [name: string]: PIXI.Texture } {\r\n\t\t\tlet map: { [name: string]: PIXI.Texture } = {};\r\n\r\n\t\t\tfor (const spr of this.sheets) {\r\n\t\t\t\tObject.assign(map, spr.textures);\r\n\t\t\t}\r\n\r\n\t\t\tObject.assign(map, this.images);\r\n\r\n\t\t\treturn map;\r\n\t\t}\r\n\r\n\t\tget animations(): { [name: string]: PIXI.Texture[] } {\r\n\t\t\tlet map: { [name: string]: PIXI.Texture[] } = {};\r\n\r\n\t\t\tfor (const spr of this.sheets) {\r\n\t\t\t\tObject.assign(map, spr.animations);\r\n\t\t\t}\r\n\r\n\t\t\treturn map;\r\n\t\t}\r\n\t}\r\n}\r\n","namespace TiledOG {\r\n    export class TiledContainer extends PIXI.Container {\r\n        layerHeight: number = 0;\r\n        layerWidth: number = 0;\r\n        text?:PIXI.Text;\r\n        primitive?: Primitives.ITiledPtimitive;\r\n        tiledId?: number\r\n    }\r\n}\r\n","//inject new field in resources\r\ndeclare module PIXI {\r\n\texport interface LoaderResource {\r\n\t\tstage?: TiledOG.TiledContainer;\r\n\t}\r\n}\r\n\r\nnamespace TiledOG {\r\n\r\n\tlet showHello: boolean = true;\r\n\tfunction PrepareOject(layer: any) {\r\n\r\n\t\tlet props: any = {};\r\n\t\tif (layer.properties) {\r\n\t\t\tif (layer.properties instanceof Array) {\r\n\t\t\t\tfor (var p of layer.properties) {\r\n\t\t\t\t\tlet val = p.value;\r\n\t\t\t\t\tif (p.type == \"color\") val = Utils.HexStringToHexInt(val);\r\n\r\n\t\t\t\t\tprops[p.name] = val;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tprops = layer.properties;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// http://doc.mapeditor.org/en/stable/reference/tmx-map-format/#tile-flipping\r\n\t\tif(layer.gid) {\r\n\t\t\t\r\n\t\t\tconst gid = layer.gid;\r\n\t\t\tconst vFlip = gid & 0x40000000;\r\n\t\t\tconst hFlip = gid & 0x80000000;\r\n\t\t\tconst dFlip = gid & 0x20000000;\r\n\r\n\t\t\tprops[\"vFlip\"] = vFlip;\r\n\t\t\tprops[\"hFlip\"] = hFlip;\r\n\t\t\tprops[\"dFlip\"] = dFlip;\r\n\r\n\t\t\tconst realGid = gid & (~ (0x40000000 | 0x80000000 | 0x20000000));\r\n\t\t\tlayer.gid = realGid;\r\n\t\t}\r\n\t\t\r\n\t\tlayer.properties = props;\r\n\r\n\t}\r\n\r\n\tfunction ImageFromTileset(tilesets: any[], baseUrl: string, gid: number) {\r\n\t\tvar tileSet = undefined; //_data.tilesets[0];\r\n\t\tfor (let i = 0; i < tilesets.length; i++) {\r\n\t\t\tif (tilesets[i].firstgid <= gid) {\r\n\t\t\t\ttileSet = tilesets[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!tileSet) {\r\n\t\t\tconsole.log(\"Image with gid:\" + gid + \" not found!\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst realGid = gid - tileSet.firstgid;\r\n\t\t\r\n\t\tlet find = (tileSet.tiles as Array<{id:number, image: string}>).filter( (obj) => obj.id == realGid)[0];\r\n\t\t\r\n\t\tlet img = Object.assign({}, find);\r\n\t\tif (!img) {\r\n\t\t\tconsole.log(\"Load res MISSED gid:\" + realGid);\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\timg.image = baseUrl + img.image;\r\n\r\n\t\treturn img;\r\n\t}\r\n\r\n\texport function CreateStage(\r\n\t\tres: PIXI.LoaderResource | PIXI.Spritesheet | Tiled.MultiSpritesheet,\r\n\t\tloader: any\r\n\t): TiledContainer | undefined {\r\n\t\tlet _data: any = {};\r\n\r\n\t\tif (res instanceof PIXI.LoaderResource) {\r\n\t\t\t_data = res.data;\r\n\t\t} else {\r\n\t\t\t_data = loader;\r\n\t\t}\r\n\r\n\t\tif (!_data || _data.type != \"map\") {\r\n\t\t\t//next();\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tif (showHello) {\r\n\t\t\tconsole.log(\"Tiled OG importer!\\n eXponenta {rondo.devil[a]gmail.com}\");\r\n\t\t\tshowHello = false;\r\n\t\t}\r\n\r\n\t\tconst useDisplay: boolean =\r\n\t\t\tConfig.usePixiDisplay != undefined && Config.usePixiDisplay && (PIXI as any).display != undefined;\r\n\r\n\t\tlet Layer = useDisplay ? (PIXI as any).display.Layer : {};\r\n\t\tlet Group = useDisplay ? (PIXI as any).display.Group : {};\r\n\t\tlet Stage = useDisplay ? (PIXI as any).display.Stage : {};\r\n\r\n\t\tconst _stage = new TiledContainer(); //useDisplay ?  new Stage() : new TiledContainer();\r\n\r\n\t\tconst cropName = new RegExp(/^.*[\\\\\\/]/);\r\n\r\n\t\t_stage.layerHeight = _data.height;\r\n\t\t_stage.layerWidth = _data.width;\r\n\r\n\t\tlet baseUrl = \"\";\r\n\r\n\t\tif (res instanceof PIXI.LoaderResource) \r\n\t\t{\r\n\t\t\t_stage.name = res.url.replace(cropName,\"\").split(\".\")[0];\r\n\r\n\t\t\tbaseUrl = res.url.replace(loader.baseUrl, \"\");\r\n\t\t\tbaseUrl = baseUrl.match(cropName)![0];\r\n\t\t}\r\n\r\n\t\tif (_data.layers) {\r\n\t\t\tlet zOrder = 0; //_data.layers.length;\r\n\r\n\t\t\tif (useDisplay) _data.layers = _data.layers.reverse();\r\n\r\n\t\t\tfor (let layer of _data.layers) {\r\n\t\t\t\tif (layer.type !== \"objectgroup\" && layer.type !== \"imagelayer\") {\r\n\t\t\t\t\tconsole.warn(\"OGParser support only OBJECT or IMAGE layes!!\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tPrepareOject(layer);\r\n\t\t\t\tconst props = layer.properties;\r\n\r\n\t\t\t\tif (props.ignore || props.ignoreLoad) {\r\n\t\t\t\t\tconsole.log(\"OGParser: ignore loading layer:\" + layer.name);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst pixiLayer = useDisplay\r\n\t\t\t\t\t? new Layer(new Group(props.zOrder !== undefined ? props.zOrder : zOrder, true))\r\n\t\t\t\t\t: new TiledContainer();\r\n\t\t\t\t\r\n\t\t\t\tzOrder++;\r\n\r\n\t\t\t\tpixiLayer.tiledId = layer.id;\r\n\r\n\t\t\t\tpixiLayer.name = layer.name;\r\n\t\t\t\t(_stage as any).layers = {};\r\n\t\t\t\t(_stage as any).layers[layer.name] = pixiLayer;\r\n\t\t\t\tpixiLayer.visible = layer.visible;\r\n\r\n\t\t\t\tpixiLayer.position.set(layer.x, layer.y);\r\n\t\t\t\tpixiLayer.alpha = layer.opacity || 1;\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tContainerBuilder.ApplyMeta(layer, pixiLayer);\r\n\t\t\t\t\r\n\t\t\t\t_stage.addChild(pixiLayer);\r\n\r\n\t\t\t\tif (layer.type == \"imagelayer\") {\r\n\t\t\t\t\tlayer.objects = [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\timg: {\r\n\t\t\t\t\t\t\t\timage: baseUrl + layer.image\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tgid: 123456789,\r\n\t\t\t\t\t\t\tname: layer.name,\r\n\t\t\t\t\t\t\tx: layer.x + layer.offsetx,\r\n\t\t\t\t\t\t\ty: layer.y + layer.offsety,\r\n\t\t\t\t\t\t\tfromImageLayer: true,\r\n\t\t\t\t\t\t\tproperties: layer.properties\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!layer.objects) return undefined;\r\n\t\t\t\t//next();\r\n\r\n\t\t\t\tlet localZIndex = 0;\r\n\t\t\t\tfor (let layerObj of layer.objects) {\r\n\t\t\t\t\tPrepareOject(layerObj);\r\n\r\n\t\t\t\t\tif (layerObj.properties.ignore) continue;\r\n\r\n\t\t\t\t\tconst type = Utils.Objectype(layerObj);\r\n\t\t\t\t\tlet pixiObject = null;\r\n\t\t\t\t\tswitch (type) {\r\n\t\t\t\t\t\tcase Utils.TiledObjectType.IMAGE: {\r\n\t\t\t\t\t\t\tif (!layerObj.fromImageLayer) {\r\n\t\t\t\t\t\t\t\tconst img = ImageFromTileset(_data.tilesets, baseUrl, layerObj.gid);\r\n\t\t\t\t\t\t\t\tif (!img) {\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tlayerObj.img = img;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t//Sprite Loader\r\n\t\t\t\t\t\t\tpixiObject = SpriteBuilder.Build(layerObj);\r\n\r\n\t\t\t\t\t\t\tlet sprite: PIXI.Sprite = pixiObject as PIXI.Sprite;\r\n\r\n\t\t\t\t\t\t\tlet cached: PIXI.Texture | PIXI.LoaderResource | undefined = undefined;\r\n\r\n\t\t\t\t\t\t\tif (loader instanceof PIXI.Loader) {\r\n\t\t\t\t\t\t\t\tcached = loader.resources[layerObj.img.image];\r\n\t\t\t\t\t\t\t} else if (res instanceof PIXI.Spritesheet) {\r\n\t\t\t\t\t\t\t\tcached = res.textures[layerObj.img.image];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (!cached) {\r\n\t\t\t\t\t\t\t\tif (loader instanceof PIXI.Loader) {\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tloader.add(\r\n\t\t\t\t\t\t\t\t\t\tlayerObj.img.image,\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tparentResource: res\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\t\t\t\tconst tex = loader.resources[layerObj.img.image].texture;\r\n\t\t\t\t\t\t\t\t\t\t\tsprite.texture = tex;\r\n\t\t\t\t\t\t\t\t\t\t\tif (layerObj.fromImageLayer) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tsprite.scale.set(1);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tif (cached instanceof PIXI.LoaderResource) {\r\n\t\t\t\t\t\t\t\t\tif (!cached.isComplete) {\r\n\t\t\t\t\t\t\t\t\t\t(cached as any).onAfterMiddleware.once((e:any) => {\r\n\t\t\t\t\t\t\t\t\t\t\tsprite.texture = (cached as any).texture;\r\n\t\t\t\t\t\t\t\t\t\t\tif (layerObj.fromImageLayer) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tsprite.scale.set(1);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tsprite.texture = cached.texture;\r\n\t\t\t\t\t\t\t\t\t\tif (layerObj.fromImageLayer) {\r\n\t\t\t\t\t\t\t\t\t\t\tsprite.scale.set(1);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t} else if (cached as PIXI.Texture) {\r\n\t\t\t\t\t\t\t\t\tsprite.texture = cached as any;\r\n\t\t\t\t\t\t\t\t\t//sprite.height = (cached as any).height;\r\n\t\t\t\t\t\t\t\t\t//sprite.width = (cached as any).width;\r\n\t\t\t\t\t\t\t\t\tif (layerObj.fromImageLayer) {\r\n\t\t\t\t\t\t\t\t\t\tsprite.scale.set(1);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// TextLoader\r\n\t\t\t\t\t\tcase Utils.TiledObjectType.TEXT: {\r\n\t\t\t\t\t\t\tpixiObject = TextBuilder.Build(layerObj);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdefault: {\r\n\t\t\t\t\t\t\tpixiObject = ContainerBuilder.Build(layerObj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (Config.usePixiDisplay) {\r\n\t\t\t\t\t\t(pixiObject as any).parentGroup = pixiLayer.group;\r\n\t\t\t\t\t\t_stage.addChildAt(pixiObject, localZIndex);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tpixiLayer.addChildAt(pixiObject, localZIndex);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlocalZIndex++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn _stage;\r\n\t}\r\n\r\n\r\n\texport let Parser = {\r\n\t\t\r\n\t\tParse(res: PIXI.LoaderResource, next: Function) {\r\n\t\t\t//@ts-ignore\r\n\t\t\tvar stage = CreateStage(res, this as any);\r\n\t\t\tres.stage = stage;\r\n\t\t\tnext();\r\n\t\t},\r\n\r\n\t\tuse(res: PIXI.LoaderResource, next: Function) {\r\n\t\t \tParser.Parse.call(this, res, next);\r\n\t\t},\r\n\r\n\t\tadd() {\r\n\t\t\tconsole.log(\"Now you use Tiled!\");\r\n\t\t}\r\n\r\n\t}\r\n}\r\n","\tnamespace TiledOG.Primitives {\r\n\texport interface ITiledPtimitive {\r\n\t\tname: string;\r\n\t\ttypes: Array<string>;\r\n\t\tvisible: boolean;\r\n\t}\r\n\r\n\texport class TiledRect extends PIXI.Rectangle implements ITiledPtimitive {\r\n\t\tname: string = \"\";\r\n\t\ttypes: string[] = [];\r\n\t\tvisible: boolean = true;\r\n\t}\r\n\r\n\texport class TiledPoint extends PIXI.Point implements ITiledPtimitive {\r\n\t\tname: string = \"\";\r\n\t\ttypes: string[] = [];\r\n\t\tvisible: boolean = true;\r\n\r\n\t\tconstructor(x?: number, y?: number) {\r\n\t\t\tsuper(x, y);\r\n\t\t}\r\n\t}\r\n\r\n\texport class TiledPolygon extends PIXI.Polygon implements ITiledPtimitive {\r\n\t\tname: string = \"\";\r\n\t\ttypes: string[] = [];\r\n\t\tvisible: boolean = true;\r\n\t\tprivate _x: number = 0;\r\n\t\tprivate _y: number = 0;\r\n\r\n\t\tconstructor(points: PIXI.Point[]) {\r\n\t\t\tsuper(points);\r\n\t\t}\r\n\r\n\t\tset x(sX: number) {\r\n\t\t\t\r\n\t\t\tconst delta = sX - this._x;\r\n\t\t\tthis._x = sX;\r\n\r\n\t\t\tfor (let xIndex = 0; xIndex < this.points.length; xIndex += 2) {\r\n\t\t\t\tthis.points[xIndex] += delta;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tset y(sY: number) {\r\n\t\t\t\r\n\t\t\tconst delta = sY - this._y;\r\n\t\t\tthis._y = sY;\r\n\r\n\t\t\tfor (let yIndex = 1; yIndex < this.points.length; yIndex += 2) {\r\n\t\t\t\tthis.points[yIndex] += delta;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tget x (): number {\r\n\t\t\treturn this._x;\r\n\t\t}\r\n\t\t\r\n\t\tget y (): number {\r\n\t\t\treturn this._y;\r\n\t\t}\r\n\r\n\t\tgetBounds(): PIXI.Rectangle{\r\n\t\t\tlet rect = new PIXI.Rectangle();\r\n\r\n\t\t\tlet maxX: number = this._x;\r\n\t\t\tlet maxY: number = this._y;\r\n\r\n\t\t\tfor (let index = 0; index < this.points.length; index += 2) {\r\n\t\t\t\tconst px = this.points[index];\r\n\t\t\t\tconst py = this.points[index + 1];\r\n\r\n\t\t\t\trect.x = px < rect.x ? px: rect.x;\r\n\t\t\t\trect.y = py < rect.y ? py: rect.y;\r\n\r\n\t\t\t\tmaxX = px > maxX ? px: maxX;\r\n\t\t\t\tmaxY = py > maxY ? py : maxY;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\trect.width = maxX  - rect.x;\r\n\t\t\trect.height = maxY - rect.y;\r\n\r\n\t\t\treturn rect;\r\n\t\t}\r\n\r\n\t\tget width() : number {\r\n\t\t\treturn this.getBounds().width;\r\n\t\t}\r\n\r\n\t\tget height(): number {\r\n\t\t\treturn this.getBounds().height;\r\n\t\t}\r\n\t\t\r\n\t\tset height(h: number) {\r\n\t\t\tconst factor = h / this.height;\r\n\t\t\t\r\n\t\t\tfor (let yIndex = 1; yIndex < this.points.length; yIndex += 2) {\r\n\t\t\t\t\r\n\t\t\t\tconst delta = (this.points[yIndex] - this._y) * factor;\r\n\t\t\t\tthis.points[yIndex] = this._y + delta;;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t\r\n\t\tset width(w: number) {\r\n\t\t\tconst factor = w / this.width;\r\n\t\t\t\r\n\t\t\tfor (let xIndex = 0; xIndex < this.points.length; xIndex += 2) {\r\n\t\t\t\t\r\n\t\t\t\tconst delta = (this.points[xIndex] - this._x) * factor;\r\n\t\t\t\tthis.points[xIndex] = this._x + delta;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\texport class TiledPolypine implements ITiledPtimitive {\r\n\t\tname: string = \"\";\r\n\t\ttypes: string[] = [];\r\n\t\tvisible: boolean = true;\r\n\r\n\t\tpoints: Array<PIXI.Point> = [];\r\n\r\n\t\tconstructor(points: Array<PIXI.Point>) {\r\n\t\t\tthis.points = points.slice();\r\n\t\t}\r\n\t}\r\n\r\n\texport class TiledEllipse extends PIXI.Ellipse implements ITiledPtimitive {\r\n\t\tname: string = \"\";\r\n\t\ttypes: string[] = [];\r\n\t\tvisible: boolean = true;\r\n\r\n\t\tconstructor(x?: number, y?: number, hw?: number, hh?: number) {\r\n\t\t\tsuper(x, y, hw, hh);\r\n\t\t}\r\n\t}\r\n\r\n\texport function BuildPrimitive(meta: any): ITiledPtimitive | undefined {\r\n\t\tif(!meta) return;\r\n\r\n\t\tlet prim: ITiledPtimitive | undefined = undefined;\r\n\r\n\t\tlet type: Utils.TiledObjectType = Utils.Objectype(meta);\r\n\r\n\t\tmeta.x = meta.x || 0;\r\n\t\tmeta.y = meta.y || 0;\r\n\t\t\r\n\t\tswitch (type) {\r\n\t\t\tcase Utils.TiledObjectType.ELLIPSE: {\r\n\t\t\t\tprim = new TiledEllipse(\r\n\t\t\t\t\tmeta.x + 0.5 * meta.width,\r\n\t\t\t\t\tmeta.y + 0.5 * meta.height,\r\n\t\t\t\t\tmeta.width * 0.5,\r\n\t\t\t\t\tmeta.height * 0.5);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase Utils.TiledObjectType.POLYGON: {\r\n\t\t\t\tlet points = meta.polygon as Array<{ x: number; y: number }>;\r\n\t\t\t\tlet poses = points.map(p => {\r\n\t\t\t\t\treturn new PIXI.Point(p.x + meta.x, p.y + meta.y);\r\n\t\t\t\t});\r\n\t\t\t\tprim = new TiledPolygon(poses);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase Utils.TiledObjectType.POLYLINE: {\r\n\t\t\t\tlet points = meta.polygon as Array<{ x: number; y: number }>;\r\n\t\t\t\tlet poses = points.map(p => {\r\n\t\t\t\t\treturn new PIXI.Point(p.x + meta.x, p.y + meta.y);\r\n\t\t\t\t});\r\n\t\t\t\tprim = new TiledPolypine(poses);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tdefault:\r\n\t\t\t\tprim = new TiledRect(meta.x, meta.y, meta.width, meta.height);\r\n\t\t}\r\n\t\tprim.types = meta.type ? meta.type.split(\":\") : [];\r\n\t\tprim.visible = meta.visible;\r\n\t\tprim.name = meta.name;\r\n\t\treturn prim;\r\n\t}\r\n}\r\n","namespace TiledOG.Utils {\r\n\texport function HexStringToHexInt(value: string | number): number {\r\n\t\tif (!value) return 0;\r\n\r\n\t\tif (typeof value == \"number\") return value;\r\n\r\n\t\tvalue = value.length > 7 ? value.substr(3, 6) : value.substr(1, 6);\r\n\r\n\t\ttry {\r\n\t\t\treturn parseInt(value, 16);\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn(\"Color parse error:\", e.message);\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t}\r\n\r\n\texport function HexStringToAlpha(value: string | number): number {\r\n\t\tif (!value) return 1;\r\n\t\tif (typeof value == \"number\") return value;\r\n\r\n\t\tif (value.length <= 7) return 1;\r\n\r\n\t\ttry {\r\n\t\t\treturn parseInt(value.substr(1, 2), 16) / 255.0;\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn(\"Alpha parse error:\", e.message);\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t}\r\n\r\n\texport enum TiledObjectType {\r\n\t\tDEFAULT,\r\n\t\tPOINT,\r\n\t\tPOLYGON,\r\n\t\tPOLYLINE,\r\n\t\tELLIPSE,\r\n\t\tTEXT,\r\n\t\tIMAGE\r\n\t}\r\n\r\n\t// https://doc.mapeditor.org/en/stable/reference/json-map-format/\r\n\r\n\texport function Objectype(meta: any): TiledObjectType {\r\n\r\n\t\tif(meta.properties && meta.properties.container) return TiledObjectType.DEFAULT;\r\n\t\tif (meta.gid || meta.image) return TiledObjectType.IMAGE;\r\n\t\tif (meta.text != undefined) return TiledObjectType.TEXT;\r\n\t\tif (meta.point) return TiledObjectType.POINT;\r\n\t\tif (meta.polygon) return TiledObjectType.POLYGON;\r\n\t\tif (meta.polyline) return TiledObjectType.POLYLINE;\r\n\t\tif (meta.ellipse) return TiledObjectType.ELLIPSE;\r\n\r\n\t\treturn TiledObjectType.DEFAULT;\r\n\t}\r\n\r\n}\r\n","namespace TiledOG {\r\n\texport let Config: ITiledProps = {\r\n\t\tdefSpriteAnchor: new PIXI.Point(0, 1),\r\n\t\tdebugContainers: false,\r\n\t\tusePixiDisplay: false,\r\n\t\troundFontAlpha: false\r\n\t};\r\n\r\n\texport let Builders: Array<Function> = [\r\n\t\tContainerBuilder.Build,\r\n\t\tSpriteBuilder.Build,\r\n\t\tTextBuilder.Build\r\n\t];\r\n\r\n\texport interface ITiledProps {\r\n\t\tdefSpriteAnchor?: PIXI.Point;\r\n\t\tdebugContainers?: boolean;\r\n\t\tusePixiDisplay?: boolean;\r\n\t\troundFontAlpha?: boolean;\r\n\t}\r\n\r\n\texport function InjectToPixi(props: ITiledProps | undefined = undefined) {\r\n\t\tif (props) {\r\n\t\t\tConfig.defSpriteAnchor = props.defSpriteAnchor || Config.defSpriteAnchor;\r\n\t\t\tConfig.debugContainers = props.debugContainers != undefined \r\n\t\t\t\t\t\t\t\t\t? props.debugContainers \r\n\t\t\t\t\t\t\t\t\t: Config.debugContainers;\r\n\r\n\t\t\tConfig.usePixiDisplay = props.usePixiDisplay != undefined \r\n\t\t\t\t\t\t\t\t\t? props.usePixiDisplay \r\n\t\t\t\t\t\t\t\t\t: Config.usePixiDisplay;\r\n\t\t\t\r\n\t\t\tConfig.roundFontAlpha = props.roundFontAlpha != undefined \r\n\t\t\t\t\t\t\t\t\t? props.roundFontAlpha \r\n\t\t\t\t\t\t\t\t\t: Config.roundFontAlpha;\r\n\t\t}\r\n\r\n\t\tPIXI.Loader.registerPlugin( Parser);\r\n\t}\r\n}\r\n\r\n//TiledOG.InjectToPixi();\r\n"]}
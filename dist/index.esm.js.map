{"version":3,"file":"index.esm.js","sources":["../src/objects/TiledContainer.ts","../src/Config.ts","../src/objects/TiledAnimator.ts","../src/tools/TiledObjectType.ts","../src/objects/TiledPrimitives.ts","../src/tools/Utils.ts","../src/objects/TiledSprite.ts","../src/builders/ContainerBuilder.ts","../src/builders/SpriteBuilder.ts","../src/builders/TextBuilder.ts","../src/tools/TiledMultiSheet.ts","../src/tools/TilesetManagers.ts","../src/objects/TiledMapContainer.ts","../src/tools/TiledObjectParser.ts","../src/pixi-utils/ContainerExt.ts","../src/pixi-utils/DisplayExt.ts","../src/pixi-utils/EventEmitterExt.ts","../src/pixi-utils/index.ts","../src/layers/LayerBuilder.ts","../src/layers/ObjectsLayerBuilder.ts","../src/layers/TiledLayerBuilder.ts","../src/index.ts"],"sourcesContent":["import { Container, Text } from \"pixi.js\"\r\nimport { ITiledPtimitive } from './TiledPrimitives';\r\nimport { IParsedProps, ITiledLayer, ITiledObject, ITiledFrame, ITiledMap } from \"./../ITiledMap\";\r\n\r\nexport class TiledContainer extends Container {\r\n\tlayerHeight: number = 0;\r\n\tlayerWidth: number = 0;\r\n\ttext?: Text;\r\n\tprimitive?: ITiledPtimitive;\r\n\ttiledId?: number;\r\n\tproperties?: IParsedProps;\r\n\tlayers?: {[key: string]: Container};\r\n\tsource?: ITiledLayer | ITiledObject | ITiledMap;\r\n\ttileFrame?: ITiledFrame;\r\n}\r\n","import { Point } from \"pixi.js\";\r\nimport { ILayerBuilder } from \"./layers/LayerBuilder\";\r\n\r\nexport interface ITiledProps {\r\n\tdefSpriteAnchor: PIXI.Point;\r\n\tdebugContainers: boolean;\r\n\tusePixiDisplay: boolean;\r\n\troundFontAlpha: boolean;\r\n\tinjectMiddleware: boolean;\r\n\troundPixels: boolean;\r\n}\r\n\r\nexport const Config: ITiledProps = {\r\n\tdefSpriteAnchor: new Point(0, 1),\r\n\tdebugContainers: false,\r\n\tusePixiDisplay: false,\r\n\troundFontAlpha: false,\r\n\tinjectMiddleware: true,\r\n\troundPixels: true\r\n};\r\n\r\nexport const LayerBuildersMap: { [key: string]: ILayerBuilder | undefined } = {};\r\n","import { TiledSprite } from \"./TiledSprite\";\r\nimport { AnimatedSprite } from \"pixi.js\";\r\nimport { ITiledTile } from \"./../ITiledMap\";\r\n\r\nexport class TileAnimator {\r\n\tprivate _animator: AnimatedSprite;\r\n\tprivate _childs: Set<TiledSprite> = new Set();\r\n\tprivate _tile: ITiledTile;\r\n\r\n\tconstructor(tile: ITiledTile) {\r\n\r\n\t\tif(!tile.animation) {\r\n\t\t\tthrow new Error(\"Tile has not animation!\");\r\n\t\t}\r\n\r\n\t\tthis._tile = tile;\r\n\t\tthis._animator = new AnimatedSprite(tile.animation);\r\n\t\tthis._animator.onFrameChange = this.__onFrame.bind(this);\r\n\t}\r\n\r\n\t__onFrame() {\r\n\t\tthis._childs.forEach((e)=> e.texture = this._animator.texture);\r\n\t}\r\n\r\n\tget anim() {\r\n\t\treturn this._animator;\r\n\t}\r\n\r\n\tadd(s: TiledSprite, strict = true) {\r\n\t\tif(!s) return;\r\n\r\n\t\t// prevent stack \r\n\t\tif(this._childs.has(s)) return;\r\n\t\t\r\n\t\ts.anim = this;\r\n\r\n\t\tif(s.tileFrame !== this._tile && strict) {\r\n\t\t\tthrow (`Invalid sprite! One Animator per tile type! Pased ${s.tileFrame!.id} should be ${this._tile.id}`);\r\n\t\t}\r\n\r\n\t\tthis._childs.add(s);\r\n\t}\r\n\r\n\tremove(s: TiledSprite) {\r\n\t\tthis._childs.delete(s);\r\n\t}\r\n}","export enum TiledObjectType {\r\n\tDEFAULT,\r\n\tPOINT,\r\n\tPOLYGON,\r\n\tPOLYLINE,\r\n\tELLIPSE,\r\n\tTEXT,\r\n\tIMAGE,\r\n}\r\n\r\n// https://doc.mapeditor.org/en/stable/reference/json-map-format/\r\n\r\nexport function Objectype(meta: any): TiledObjectType {\r\n\tif (meta.properties && meta.properties.container) return TiledObjectType.DEFAULT;\r\n\tif (meta.gid || meta.image) return TiledObjectType.IMAGE;\r\n\tif (meta.text != undefined) return TiledObjectType.TEXT;\r\n\tif (meta.point) return TiledObjectType.POINT;\r\n\tif (meta.polygon) return TiledObjectType.POLYGON;\r\n\tif (meta.polyline) return TiledObjectType.POLYLINE;\r\n\tif (meta.ellipse) return TiledObjectType.ELLIPSE;\r\n\r\n\treturn TiledObjectType.DEFAULT;\r\n}","import { Rectangle, Point, Polygon, Ellipse } from \"pixi.js\";\r\nimport { ITiledObject } from \"./../ITiledMap\";\r\nimport { TiledObjectType, Objectype } from \"../tools/TiledObjectType\";\r\n\r\nexport interface ITiledPtimitive {\r\n\tname: string;\r\n\ttypes: Array<string>;\r\n\tvisible: boolean;\r\n}\r\n\r\nexport class TiledRect extends Rectangle implements ITiledPtimitive {\r\n\tname: string = \"\";\r\n\ttypes: string[] = [];\r\n\tvisible: boolean = true;\r\n}\r\n\r\nexport class TiledPoint extends Point implements ITiledPtimitive {\r\n\tname: string = \"\";\r\n\ttypes: string[] = [];\r\n\tvisible: boolean = true;\r\n\r\n\tconstructor(x?: number, y?: number) {\r\n\t\tsuper(x, y);\r\n\t}\r\n}\r\n\r\nexport class TiledPolygon extends Polygon implements ITiledPtimitive {\r\n\tname: string = \"\";\r\n\ttypes: string[] = [];\r\n\tvisible: boolean = true;\r\n\r\n\tprivate _x: number = 0;\r\n\tprivate _y: number = 0;\r\n\r\n\tconstructor(points: Point[]) {\r\n\t\tsuper(points);\r\n\t}\r\n\r\n\tset x(sX: number) {\r\n\t\tconst delta = sX - this._x;\r\n\t\tthis._x = sX;\r\n\r\n\t\tfor (let xIndex = 0; xIndex < this.points.length; xIndex += 2) {\r\n\t\t\tthis.points[xIndex] += delta;\r\n\t\t}\r\n\t}\r\n\r\n\tset y(sY: number) {\r\n\t\tconst delta = sY - this._y;\r\n\t\tthis._y = sY;\r\n\r\n\t\tfor (let yIndex = 1; yIndex < this.points.length; yIndex += 2) {\r\n\t\t\tthis.points[yIndex] += delta;\r\n\t\t}\r\n\t}\r\n\r\n\tget x(): number {\r\n\t\treturn this._x;\r\n\t}\r\n\r\n\tget y(): number {\r\n\t\treturn this._y;\r\n\t}\r\n\r\n\tgetBounds(): Rectangle {\r\n\t\tlet rect = new Rectangle();\r\n\r\n\t\tlet maxX: number = this._x;\r\n\t\tlet maxY: number = this._y;\r\n\r\n\t\tfor (let index = 0; index < this.points.length; index += 2) {\r\n\t\t\tconst px = this.points[index];\r\n\t\t\tconst py = this.points[index + 1];\r\n\r\n\t\t\trect.x = px < rect.x ? px : rect.x;\r\n\t\t\trect.y = py < rect.y ? py : rect.y;\r\n\r\n\t\t\tmaxX = px > maxX ? px : maxX;\r\n\t\t\tmaxY = py > maxY ? py : maxY;\r\n\t\t}\r\n\r\n\t\trect.width = maxX - rect.x;\r\n\t\trect.height = maxY - rect.y;\r\n\r\n\t\treturn rect;\r\n\t}\r\n\r\n\tget width(): number {\r\n\t\treturn this.getBounds().width;\r\n\t}\r\n\r\n\tget height(): number {\r\n\t\treturn this.getBounds().height;\r\n\t}\r\n\r\n\tset height(h: number) {\r\n\t\tconst factor = h / this.height;\r\n\r\n\t\tfor (let yIndex = 1; yIndex < this.points.length; yIndex += 2) {\r\n\t\t\tconst delta = (this.points[yIndex] - this._y) * factor;\r\n\t\t\tthis.points[yIndex] = this._y + delta;\r\n\t\t}\r\n\t}\r\n\r\n\tset width(w: number) {\r\n\t\tconst factor = w / this.width;\r\n\r\n\t\tfor (let xIndex = 0; xIndex < this.points.length; xIndex += 2) {\r\n\t\t\tconst delta = (this.points[xIndex] - this._x) * factor;\r\n\t\t\tthis.points[xIndex] = this._x + delta;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class TiledPolypine implements ITiledPtimitive {\r\n\tname: string = \"\";\r\n\ttypes: string[] = [];\r\n\tvisible: boolean = true;\r\n\r\n\tpoints: Array<Point> = [];\r\n\r\n\tconstructor(points: Array<Point>) {\r\n\t\tthis.points = points.slice();\r\n\t}\r\n}\r\n\r\nexport class TiledEllipse extends Ellipse implements ITiledPtimitive {\r\n\tname: string = \"\";\r\n\ttypes: string[] = [];\r\n\tvisible: boolean = true;\r\n\r\n\tconstructor(x?: number, y?: number, hw?: number, hh?: number) {\r\n\t\tsuper(x, y, hw, hh);\r\n\t}\r\n}\r\n\r\nexport function BuildPrimitive( meta: ITiledObject ): ITiledPtimitive | undefined {\r\n\t\r\n\tif (!meta) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tlet prim: ITiledPtimitive | undefined = undefined;\r\n\r\n\tconst type: TiledObjectType = Objectype(meta);\r\n\r\n\tmeta.x = meta.x || 0;\r\n\tmeta.y = meta.y || 0;\r\n\r\n\tswitch (type) {\r\n\t\tcase TiledObjectType.ELLIPSE: {\r\n\t\t\tprim = new TiledEllipse(\r\n\t\t\t\tmeta.x + 0.5 * meta.width,\r\n\t\t\t\tmeta.y + 0.5 * meta.height,\r\n\t\t\t\tmeta.width * 0.5,\r\n\t\t\t\tmeta.height * 0.5\r\n\t\t\t);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase TiledObjectType.POLYGON: {\r\n\t\t\tconst points = meta.polygon!;\r\n\t\t\tconst poses = points.map(p => {\r\n\t\t\t\treturn new Point(p.x + meta.x, p.y + meta.y);\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tprim = new TiledPolygon(poses);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tcase TiledObjectType.POLYLINE: {\r\n\t\t\tconst points = meta.polygon!;\r\n\t\t\tconst poses = points.map(p => {\r\n\t\t\t\treturn new Point(p.x + meta.x, p.y + meta.y);\r\n\t\t\t});\r\n\r\n\t\t\tprim = new TiledPolypine(poses);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tdefault:\r\n\t\t\tprim = new TiledRect(meta.x, meta.y, meta.width, meta.height);\r\n\t}\r\n\r\n\tprim.types = meta.type ? meta.type.split(\":\") : [];\r\n\tprim.visible = meta.visible;\r\n\tprim.name = meta.name;\r\n\t\r\n\treturn prim;\r\n}\r\n","import { ITiledTileset, ITiledMap, IParsedProps, ITiledLayer, ITiledObject, ITiledSprite } from '../ITiledMap';\r\nimport { Graphics, Sprite } from 'pixi.js';\r\nimport { Config } from '../Config';\r\nimport { BuildPrimitive } from './../objects/TiledPrimitives';\r\nimport { TiledContainer } from './../objects/TiledContainer';\r\n\r\nexport function HexStringToHexInt(value: string | number): number {\r\n\tif (!value) return 0;\r\n\r\n\tif (typeof value == 'number') return value;\r\n\r\n\tvalue = value.length > 7 ? value.substr(3, 6) : value.substr(1, 6);\r\n\r\n\ttry {\r\n\t\treturn parseInt(value, 16);\r\n\t} catch (e) {\r\n\t\tconsole.warn('Color parse error:', e.message);\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\nexport function HexStringToAlpha(value: string | number): number {\r\n\tif (!value) return 1;\r\n\tif (typeof value == 'number') return value;\r\n\r\n\tif (value.length <= 7) return 1;\r\n\r\n\ttry {\r\n\t\treturn parseInt(value.substr(1, 2), 16) / 255.0;\r\n\t} catch (e) {\r\n\t\tconsole.warn('Alpha parse error:', e.message);\r\n\t\treturn 1;\r\n\t}\r\n}\r\n\r\nexport function resolveTile(tilesets: ITiledTileset[], gid: number) {\r\n\tlet tileSet = undefined; //_data.tilesets[0];\r\n\tlet tilesetId = 0;\r\n\r\n\tfor (let i = 0; i < tilesets.length; i++) {\r\n\t\tif (tilesets[i].firstgid <= gid) {\r\n\t\t\ttileSet = tilesets[i];\r\n\t\t\ttilesetId = i;\r\n\t\t}\r\n\t}\r\n\r\n\tif (!tileSet) {\r\n\t\tconsole.error('Image with gid:' + gid + ' not found!');\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst realGid = gid - tileSet.firstgid;\r\n\r\n\tlet find = tileSet.tiles!.filter(obj => obj.id == realGid)[0];\r\n\tlet img = Object.assign({}, find, { tilesetId });\r\n\r\n\tif (!img) {\r\n\t\tconsole.error('Load res MISSED gid:' + realGid);\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn img;\r\n}\r\n\r\nexport function _prepareProperties(layer: ITiledMap | ITiledLayer | ITiledObject) {\r\n\tlet props: IParsedProps = {};\r\n\r\n\tif (layer.properties) {\r\n\t\tif (layer.properties instanceof Array) {\r\n\t\t\tfor (var p of layer.properties) {\r\n\t\t\t\tlet val = p.value;\r\n\t\t\t\tif (p.type == 'color') {\r\n\t\t\t\t\tval = HexStringToHexInt(val as string);\r\n\t\t\t\t}\r\n\t\t\t\tprops[p.name] = val;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// old tiled format\r\n\t\t\tprops = layer.properties;\r\n\t\t}\r\n\t}\r\n\r\n\tconst spriteObject = layer as ITiledSprite;\r\n\r\n\t// http://doc.mapeditor.org/en/stable/reference/tmx-map-format/#tile-flipping\r\n\tif (spriteObject.gid > 0) {\r\n\t\tconst gid = spriteObject.gid;\r\n\r\n\t\tconst vFlip = !!(gid & 0x40000000);\r\n\t\tconst hFlip = !!(gid & 0x80000000);\r\n\t\tconst dFlip = !!(gid & 0x20000000);\r\n\r\n\t\tprops['vFlip'] = vFlip;\r\n\t\tprops['hFlip'] = hFlip;\r\n\t\tprops['dFlip'] = dFlip;\r\n\r\n\t\tspriteObject.vFlip = vFlip;\r\n\t\tspriteObject.hFlip = hFlip;\r\n\r\n\t\tconst realGid = gid & ~(0x40000000 | 0x80000000 | 0x20000000);\r\n\t\tspriteObject.gid = realGid;\r\n\t}\r\n\r\n\tlayer.parsedProps = props;\r\n}\r\n\r\nexport function ApplyMeta(meta: ITiledObject | ITiledLayer, target: TiledContainer) {\r\n\ttarget.name = meta.name;\r\n\ttarget.tiledId = meta.id;\r\n\ttarget.width = meta.width || target.width;\r\n\ttarget.height = meta.height || target.height;\r\n\ttarget.rotation = (((meta as ITiledObject).rotation || 0) * Math.PI) / 180.0;\r\n\r\n\ttarget.x = meta.x || 0;\r\n\ttarget.y = meta.y || 0;\r\n\r\n\ttarget.visible = meta.visible == undefined ? true : meta.visible;\r\n\ttarget.types = meta.type ? meta.type.split(\":\") : [];\r\n\r\n\ttarget.primitive = BuildPrimitive(meta as ITiledObject);\r\n\r\n\tconst props = meta.parsedProps;\r\n\r\n\tif (props) {\r\n\t\tif (!isNaN(props.opacity as number)) {\r\n\t\t\ttarget.alpha = Number(props.opacity);\r\n\t\t}\r\n\r\n\t\t//@ts-ignore\r\n\t\tObject.assign(target, props);\r\n\r\n\t\ttarget.properties = props;\r\n\t}\r\n\r\n\ttarget.source = meta;\r\n\r\n\tif (Config.debugContainers) {\r\n\t\tsetTimeout(() => {\r\n\t\t\tconst rect = new Graphics();\r\n\r\n\t\t\trect.lineStyle(2, 0xff0000, 0.7)\r\n\t\t\t\t.drawRect(target.x, target.y, meta.width, meta.height)\r\n\t\t\t\t.endFill();\r\n\t\t\tif (target instanceof Sprite) {\r\n\t\t\t\trect.y -= target.height;\r\n\t\t\t}\r\n\t\t\ttarget.parent.addChild(rect);\r\n\t\t}, 30);\r\n\t}\r\n}","import { Sprite } from 'pixi.js';\r\nimport { ITiledTile, ITiledSprite, ITiledObjectLayer } from './../ITiledMap';\r\nimport { TileAnimator } from './TiledAnimator';\r\nimport { Config } from './../Config';\r\nimport { BuildPrimitive } from './TiledPrimitives';\r\nimport { ITiledPtimitive } from './TiledPrimitives';\r\nimport { ApplyMeta } from '../tools/Utils';\r\n\r\nexport class TiledSprite extends Sprite {\r\n\tpublic tileFrame?: ITiledTile;\r\n\tpublic source?: ITiledSprite;\r\n\tpublic primitives: ITiledPtimitive[] = [];\r\n\t\r\n\tprivate _animator?: TileAnimator;\r\n\r\n\tconstructor(source: ITiledSprite, createAnimator = false, autoInit = true) {\r\n\t\tsuper(source.image!.texture);\r\n\r\n\t\tthis.source = source;\r\n\t\tthis.tileFrame = source.image!;\r\n\r\n\t\tif (createAnimator && this.tileFrame.animation) {\r\n\t\t\tthis.anim = new TileAnimator(this.tileFrame!);\r\n\t\t}\r\n\r\n\t\tif(autoInit) {\r\n\t\t\tthis.init();\r\n\t\t}\r\n\t}\r\n\r\n\tinit() {\r\n\t\tApplyMeta(this.source!, this as any);\r\n\r\n\t\tif (this.anim) {\r\n\t\t\tconst a = this.anim.anim;\r\n\r\n\t\t\tthis.properties!.animPlaying && a.play();\r\n\t\t\ta.loop = this.properties!.animLoop !== undefined ? !!this.properties!.animLoop : true;\r\n\t\t}\r\n\r\n\t\t//TODO Set anchor and offsets to center (.5, .5)\r\n\t\tif (this.source!.gid) {\r\n\t\t\tthis.anchor.copyFrom( (this.source!.anchor ||  Config.defSpriteAnchor) as any);\r\n\t\t}\r\n\r\n\t\tconst obj = this.tileFrame!.objectgroup as ITiledObjectLayer;\r\n\r\n\t\tif (obj) {\r\n\t\t\tthis.primitives = obj.objects.map(e => BuildPrimitive(e)!);\r\n\t\t}\r\n\r\n\t\tconst hFlip = this.source!.hFlip;\r\n\t\tconst vFlip = this.source!.vFlip;\r\n\r\n\t\tif (hFlip) {\r\n\t\t\tthis.scale.x *= -1;\r\n\t\t\tthis.anchor.x = 1;\r\n\t\t}\r\n\r\n\t\tif (vFlip) {\r\n\t\t\tthis.scale.y *= -1;\r\n\t\t\tthis.anchor.y = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tset anim(anim: TileAnimator | undefined) {\r\n\t\tif (anim === this._animator) return;\r\n\r\n\t\tif (this._animator) {\r\n\t\t\tthis._animator.remove(this);\r\n\t\t}\r\n\t\tthis._animator = anim;\r\n\r\n\t\tanim && anim.add(this);\r\n\t}\r\n\r\n\tget anim() {\r\n\t\treturn this._animator;\r\n\t}\r\n\r\n\tclone() {\r\n\t\tconst sprite = new TiledSprite(this.source!, true);\r\n\t\tsprite.init();\r\n\r\n\t\treturn sprite;\r\n\t}\r\n}\r\n","import { TiledContainer } from \"./../objects/TiledContainer\";\r\nimport { Config } from \"../Config\";\r\nimport {\r\n\tRectangle,\r\n\tTexture,\r\n} from \"pixi.js\";\r\n\r\nimport { ITiledObject, ITiledSprite } from \"../ITiledMap\";\r\nimport { TiledSprite } from \"./../objects/TiledSprite\";\r\nimport { ApplyMeta } from \"../tools/Utils\";\r\n\r\nexport function Build(meta: ITiledObject): TiledContainer | TiledSprite {\r\n\tconst types: Array<string> = meta.type ? meta.type.split(\":\") : [];\r\n\r\n\tlet container = undefined; // new TiledOG.TiledContainer();\r\n\r\n\tif (types.indexOf(\"mask\") > -1) {\r\n\t\tconst source = {\r\n\t\t\timage: {\r\n\t\t\t\ttexture: Texture.WHITE,\r\n\t\t\t\tid: - 1,\r\n\t\t\t},\r\n\t\t\tfromImageLayer: true\r\n\t\t} as ITiledSprite\r\n\t\tcontainer = new TiledSprite(source);\r\n\t} else {\r\n\t\tcontainer = new TiledContainer();\r\n\t\tApplyMeta(meta, container as TiledContainer);\r\n\t}\r\n\r\n\tif (meta.gid) {\r\n\t\tcontainer.pivot = Config.defSpriteAnchor as any;\r\n\t\tcontainer.hitArea = new Rectangle(0, 0, meta.width, meta.height);\r\n\t}\r\n\r\n\treturn container;\r\n}\r\n","\r\nimport { Sprite } from \"pixi.js\";\r\nimport { ITiledSprite } from \"../ITiledMap\";\r\nimport { TiledSprite } from \"./../objects/TiledSprite\";\r\n\r\nexport function Build(meta: ITiledSprite): Sprite {\r\n\t// legacy\r\n\tconst sprite = new TiledSprite(meta, true);\r\n\r\n\treturn sprite;\r\n}\r\n","import { TiledContainer } from \"./../objects/TiledContainer\";\r\nimport { Text, TextStyle } from \"pixi.js\";\r\nimport { Config } from \"../Config\";\r\nimport * as Utils from \"../tools/Utils\";\r\nimport { ITiledObject } from \"../ITiledMap\";\r\nimport { ApplyMeta } from \"../tools/Utils\";\r\n\r\nexport function Build(meta: ITiledObject): TiledContainer {\r\n\tconst container = new TiledContainer();\r\n\tconst text = meta.text!;\r\n\r\n\tlet pixiText = new Text(text.text, {\r\n\t\twordWrap: text.wrap,\r\n\t\twordWrapWidth: meta.width,\r\n\t\tfill: Utils.HexStringToHexInt(text.color || \"#000000\") || 0x000000,\r\n\t\talign: text.valign || \"top\",\r\n\t\tfontFamily: text.fontfamily || \"sans-serif\",\r\n\t\tfontWeight: text.bold ? \"bold\" : \"normal\",\r\n\t\tfontStyle: text.italic ? \"italic\" : \"normal\",\r\n\t\tfontSize: text.pixelsize || \"16px\"\r\n\t} as TextStyle);\r\n\r\n\tpixiText.name = meta.name + \"_Text\";\r\n\r\n\tpixiText.roundPixels = !!Config.roundFontAlpha;\r\n\r\n\tconst props = meta.parsedProps;\r\n\r\n\t// clear properties\r\n\tmeta.properties = [];\r\n\tmeta.parsedProps = {};\r\n\r\n\tApplyMeta(meta, container);\r\n\tcontainer.pivot.set(0, 0);\r\n\r\n\tswitch (text.halign) {\r\n\t\tcase \"right\":\r\n\t\t\t{\r\n\t\t\t\tpixiText.anchor.x = 1;\r\n\t\t\t\tpixiText.position.x = meta.width;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"center\":\r\n\t\t\t{\r\n\t\t\t\tpixiText.anchor.x = 0.5;\r\n\t\t\t\tpixiText.position.x = meta.width * 0.5;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\t{\r\n\t\t\t\tpixiText.anchor.x = 0;\r\n\t\t\t\tpixiText.position.x = 0;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\tswitch (text.valign) {\r\n\t\tcase \"bottom\":\r\n\t\t\t{\r\n\t\t\t\tpixiText.anchor.y = 1;\r\n\t\t\t\tpixiText.position.y = meta.height;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"center\":\r\n\t\t\t{\r\n\t\t\t\tpixiText.anchor.y = 0.5;\r\n\t\t\t\tpixiText.position.y = meta.height * 0.5;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\t{\r\n\t\t\t\tpixiText.anchor.y = 0;\r\n\t\t\t\tpixiText.position.y = 0;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\tif (props) {\r\n\t\tpixiText.style.stroke =\r\n\t\t\tUtils.HexStringToHexInt(props.strokeColor as string) || 0;\r\n\t\tpixiText.style.strokeThickness = props.strokeThickness || 0;\r\n\t\tpixiText.style.padding = props.fontPadding || 0;\r\n\r\n\t\tObject.assign(pixiText, props);\r\n\t}\r\n\r\n\t//_cont.parentGroup = _layer.group;\r\n\tcontainer.addChild(pixiText);\r\n\tcontainer.text = pixiText;\r\n\r\n\tcontainer.properties = props;\r\n\r\n\treturn container;\r\n}","import { Spritesheet, Texture } from \"pixi.js\";\r\n\r\nexport class MultiSpritesheet {\r\n\tsheets: Array<Spritesheet | MultiSpritesheet> = [];\r\n\timages: { [name: string]: Texture } = {};\r\n\r\n\tconstructor(sheets?: Spritesheet[]) {\r\n\t\tif (sheets) {\r\n\t\t\tsheets.forEach(element => {\r\n\t\t\t\tthis.add(element);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tadd(sheet?: Spritesheet | MultiSpritesheet) {\r\n\t\tif (!sheet) throw \"Sheet can't be undefined\";\r\n\t\tif (sheet === this) throw \"U can't add self to spritesheet\";\r\n\r\n\t\tthis.sheets.push(sheet);\r\n\t}\r\n\r\n\taddTexture(tex: Texture, id: string) {\r\n\t\tthis.images[id] = tex;\r\n\t}\r\n\r\n\tget textures(): { [name: string]: Texture } {\r\n\t\tlet map: { [name: string]: Texture } = {};\r\n\r\n\t\tfor (const spr of this.sheets) {\r\n\t\t\tObject.assign(map, spr.textures);\r\n\t\t}\r\n\r\n\t\tObject.assign(map, this.images);\r\n\r\n\t\treturn map;\r\n\t}\r\n\r\n\tget animations(): { [name: string]: Texture[] } {\r\n\t\tlet map: { [name: string]: Texture[] } = {};\r\n\r\n\t\tfor (const spr of this.sheets) {\r\n\t\t\t// can be looped\r\n\t\t\tObject.assign(map, spr.animations);\r\n\t\t}\r\n\r\n\t\treturn map;\r\n\t}\r\n}\r\n","import { ITiledTileset, ITiledTile } from '../ITiledMap';\r\nimport { MultiSpritesheet } from './TiledMultiSheet';\r\nimport { resolveTile } from './Utils';\r\n\r\nimport { Spritesheet, Texture, utils, ITextureDictionary, resources, BaseTexture, Rectangle } from 'pixi.js';\r\n\r\nclass FixedImageResource extends resources.ImageResource {\r\n\tload(): Promise<void> {\r\n\t\treturn new Promise((res, rej) => {\r\n\t\t\tconst rejector = {\r\n\t\t\t\tonError: rej,\r\n\t\t\t};\r\n\r\n\t\t\t// @ts-ignore\r\n\t\t\t(this.onError as any).add(rejector);\r\n\t\t\tsuper.load().then(res);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport class TilesetManager extends utils.EventEmitter {\r\n\tprivate _sheet: MultiSpritesheet = new MultiSpritesheet();\r\n\tprivate _loadQueue: number = 0;\r\n\r\n\t/**\r\n\t * @description Base url for all images\r\n\t */\r\n\tpublic baseUrl: string = '';\r\n\r\n\t/**\r\n\t * @description Preload images which not exist in spritesheet\r\n\t */\r\n\tpublic loadUnknowImages: boolean = true;\r\n\r\n\tconstructor(private _tileSets: ITiledTileset[], sheet?: MultiSpritesheet | Spritesheet | ITextureDictionary) {\r\n\t\tsuper();\r\n\r\n\t\tif (sheet) {\r\n\t\t\tif (sheet!.textures) {\r\n\t\t\t\tthis.register(sheet as MultiSpritesheet);\r\n\t\t\t} else {\r\n\t\t\t\tObject.keys(sheet).forEach(e => {\r\n\t\t\t\t\tthis._sheet.addTexture((sheet as ITextureDictionary)[e], e);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tregister(spritesheet: MultiSpritesheet | Spritesheet) {\r\n\t\tthis._sheet.add(spritesheet);\r\n\t}\r\n\r\n\tget spritesheet() {\r\n\t\treturn this._sheet;\r\n\t}\r\n\r\n\tgetTileByGid(gid: number, tryLoad = this.loadUnknowImages): ITiledTile | undefined {\r\n\t\tconst tile = resolveTile(this._tileSets, gid);\r\n\t\treturn this.getTileByTile(tile, tryLoad);\r\n\t}\r\n\r\n\tgetTileByTile(tile: ITiledTile | null, tryLoad = this.loadUnknowImages, skipAnim = false) {\r\n\t\tif (!tile) {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tconst set = this._tileSets[tile.tilesetId!];\r\n\r\n\t\tif(!tile.image && set.image) {\r\n\t\t\ttile.fromSheet = true;\r\n\t\t\ttile.image = set.image;\r\n\t\t}\r\n\r\n\t\tif(!tile.image) {\r\n\t\t\treturn undefined;\r\n\t\t};\r\n\r\n\t\tif (tile.animation && !skipAnim) {\r\n\r\n\t\t\ttile.animation.forEach(e => {\r\n\t\t\t\tconst atile = set.tiles![e.tileid];\r\n\r\n\t\t\t\tatile.tilesetId = tile.tilesetId;\r\n\t\t\t\te.texture = this.getTileByTile(atile, tryLoad, true)!.texture;\r\n\t\t\t\te.time = e.duration;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst absUrl = this.baseUrl + tile.image!;\r\n\r\n\t\tlet texture = this.spritesheet.textures[tile.image];\r\n\r\n\t\ttile.lazyLoad = false;\r\n\r\n\t\tif (!texture && tryLoad) {\r\n\t\t\ttexture = this._tryLoadTexture(absUrl, tile);\r\n\r\n\t\t\ttile.lazyLoad = true;\r\n\r\n\t\t\tthis._sheet.addTexture(texture, tile.image);\r\n\t\t}\r\n\r\n\t\tif(texture && tile.fromSheet) {\r\n\t\t\ttexture = this._cropTile(set, tile, texture);\r\n\t\t}\r\n\r\n\t\ttile.texture = texture;\r\n\r\n\t\treturn tile;\r\n\t}\r\n\r\n\tgetTileSetByGid(gid: number): ITiledTileset | undefined {\r\n\t\tconst frame = resolveTile(this._tileSets, gid);\r\n\t\t\r\n\t\tif(!frame) {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\treturn this._tileSets[frame!.tilesetId];\r\n\t}\r\n\r\n\t_cropTile(set: ITiledTileset, tile: ITiledTile, texture: Texture) {\r\n\t\t\r\n\t\tconst colls = set.columns!;\r\n\t\tconst rows = set.tilecount! / colls;\r\n\t\tconst margin = set.margin! || 0;\r\n\t\tconst space = set.spacing! || 0;\r\n\t\tconst xId = tile.id % colls;\r\n\t\tconst yId = tile.id / colls | 0;\r\n\r\n\t\ttexture = new Texture(texture.baseTexture, new Rectangle(\r\n\t\t\tmargin + xId * (set.tilewidth! + space),\r\n\t\t\tmargin + yId * (set.tileheight! + space),\r\n\t\t\tset.tileheight, set.tilewidth\r\n\t\t));\r\n\r\n\t\tthis._sheet.addTexture(texture, `${tile.image}_${tile.tilesetId}:${tile.id}`);\r\n\r\n\t\treturn texture;\r\n\t}\r\n\r\n\t_tryLoadTexture(url: string, tile: ITiledTile) {\r\n\t\t// @ts-ignore\r\n\t\tconst res = new FixedImageResource(url, {\r\n\t\t\tautoLoad: false,\r\n\t\t\tcrossorigin: 'anonymous',\r\n\t\t});\r\n\r\n\t\tconst texture = new Texture(new BaseTexture(res));\r\n\t\tTexture.addToCache(texture, url);\r\n\r\n\t\tthis._loadQueue++;\r\n\r\n\t\tres.load()\r\n\t\t\t.then(() => {\r\n\t\t\t\ttexture.emit('loaded');\r\n\t\t\t})\r\n\t\t\t.catch((e: any)=>{\r\n\t\t\t\tconsole.warn(`Tile set image loading error!`,tile);\r\n\t\t\t})\r\n\t\t\t.finally(() => {\r\n\t\t\t\tthis._loadQueue--;\r\n\t\t\t\tif (this._loadQueue === 0) {\r\n\t\t\t\t\tthis.emit('loaded');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\treturn texture;\r\n\t}\r\n\r\n\tget loaded() {\r\n\t\treturn this._loadQueue <= 0;\r\n\t}\r\n}\r\n","import { TiledContainer } from \"./TiledContainer\";\r\nimport { TilesetManager } from \"../tools/TilesetManagers\";\r\n\r\nexport class TiledMapContainer extends TiledContainer {\r\n\tpublic tileSet?: TilesetManager;\r\n}","import { Spritesheet, LoaderResource, ITextureDictionary, Loader } from 'pixi.js';\r\nimport { TiledContainer } from '../objects/TiledContainer';\r\nimport { Config, LayerBuildersMap } from '../Config';\r\n\r\nimport { MultiSpritesheet } from './TiledMultiSheet';\r\nimport { ITiledMap } from '../ITiledMap';\r\nimport { TilesetManager } from './TilesetManagers';\r\nimport { TiledMapContainer } from '../objects/TiledMapContainer';\r\n\r\n//inject new field in resources\r\ndeclare module 'pixi.js' {\r\n\texport interface LoaderResource {\r\n\t\tstage?: TiledContainer;\r\n\t}\r\n}\r\n\r\ntype tValidSheet = Spritesheet | MultiSpritesheet | ITextureDictionary;\r\nlet showHello: boolean = true;\r\n\r\nexport function CreateStage(\r\n\tsheet: tValidSheet | undefined,\r\n\t_data: ITiledMap,\r\n\tbaseUrl: string = '',\r\n): TiledMapContainer | undefined {\r\n\t//validate\r\n\tif (!_data || _data.type != 'map') {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tif (showHello) {\r\n\t\tconsole.log('[TILED] Importer!\\neXponenta {rondo.devil[a]gmail.com}');\r\n\t\tshowHello = false;\r\n\t}\r\n\r\n\tconst useDisplay: boolean = !!Config.usePixiDisplay && (PIXI as any).display !== undefined;\r\n\tconst stage = new TiledMapContainer();\r\n\r\n\tstage.layerHeight = _data.height;\r\n\tstage.layerWidth = _data.width;\r\n\tstage.source = _data;\r\n\r\n\tstage.tileSet = new TilesetManager(_data.tilesets, sheet);\r\n\tstage.tileSet.baseUrl = baseUrl;\r\n\r\n\tif (_data.layers) {\r\n\t\tlet zOrder = 0; //_data.layers.length;\r\n\r\n\t\tif (useDisplay) {\r\n\t\t\t_data.layers = _data.layers.reverse();\r\n\t\t}\r\n\r\n\t\tfor (let layer of _data.layers) {\r\n\t\t\tconst builder = LayerBuildersMap[layer.type];\r\n\r\n\t\t\tif (!builder) {\r\n\t\t\t\tconsole.warn(`[TILED] Importer can't support ${layer.type} layer type!`);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tconst pixiLayer = builder.Build(layer, stage.tileSet, zOrder, stage);\r\n\r\n\t\t\tif (!pixiLayer) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tzOrder++;\r\n\t\t\tstage.layers = {\r\n\t\t\t\t[layer.name]: pixiLayer,\r\n\t\t\t};\r\n\r\n\t\t\tstage.addChild(pixiLayer);\r\n\t\t}\r\n\t}\r\n\r\n\treturn stage;\r\n}\r\n\r\nexport const Parser = {\r\n\tParse(res: LoaderResource, next: Function) {\r\n\t\tconst data = res.data;\r\n\t\tconst cropName = new RegExp(/^.*[\\\\\\/]/);\r\n\r\n\t\tlet baseUrl = res.url.replace((this as any).baseUrl, '');\r\n\t\tbaseUrl = baseUrl.match(cropName)![0];\r\n\r\n\t\tconst stage = CreateStage(res.textures!, data, baseUrl);\r\n\r\n\t\tif (!stage) {\r\n\t\t\tnext();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tstage.name = res.url.replace(cropName, '').split('.')[0];\r\n\t\tres.stage = stage;\r\n\r\n\t\tif (stage.tileSet!.loaded) {\r\n\t\t\tnext();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tstage.tileSet!.once('loaded', () => next());\r\n\t},\r\n\r\n\tuse(res: LoaderResource, next: Function) {\r\n\t\tParser.Parse.call(this, res, next);\r\n\t},\r\n\r\n\tadd() {\r\n\t\tconsole.log('[TILED] middleware registered!');\r\n\t},\r\n};\r\n","import * as PIXI from \"pixi.js\";\r\nimport { IParsedProps } from \"../ITiledMap\";\r\n\r\ndeclare module \"pixi.js\" {\r\n\texport interface Container {\r\n        getChildByPath<T extends PIXI.DisplayObject>(query: string): T | undefined;\r\n\t\taddGlobalChild(...child: PIXI.DisplayObject[]): PIXI.DisplayObject;\r\n\t\tproperties?: IParsedProps;\r\n\t}\r\n}\r\n\r\nexport default function(pack : {Container : any}) {\r\n\t\r\n\tif(!pack.Container)\r\n\t\tthrow new Error(\"Cant't find Container in package!\");\r\n\t\r\n\t/**\r\n\t * @mixes\r\n\t * MIXIN FROM pixiv5-tiled\r\n\t * Get child by path\r\n\t */\r\n\tPIXI.Container.prototype.getChildByPath = function<T extends PIXI.DisplayObject>(path: string) {\r\n\t\tif (!this.children || this.children.length == 0) return undefined;\r\n\r\n\t\tlet result: PIXI.DisplayObject | undefined = this;\r\n\r\n\t\tconst split = path.split(\"/\");\r\n\t\tconst isIndex = new RegExp(\"(?:{{0})-?d+(?=})\");\r\n\r\n\t\tfor (const p of split) {\r\n\t\t\t//@ts-ignore\r\n\t\t\tif (result == undefined || !(result.children)) {\r\n\t\t\t\tresult = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (p.trim().length == 0) continue;\r\n\r\n\t\t\t// find by index\r\n\t\t\t//@ts-ignore\r\n\t\t\tconst ch = result.children;\r\n\t\t\tconst mathes = p.match(isIndex);\r\n\t\t\tif (mathes) {\r\n\t\t\t\tlet index = parseInt(mathes[0]);\r\n\t\t\t\tif (index < 0) {\r\n\t\t\t\t\tindex += ch.length;\r\n\t\t\t\t}\r\n\t\t\t\tif (index >= ch.length) {\r\n\t\t\t\t\tresult = undefined;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = ch[index];\r\n\t\t\t\t}\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t//default by name\r\n\t\t\tresult = (result as PIXI.Container).getChildByName(p);\r\n\t\t}\r\n\r\n\t\treturn result as T;\r\n\t}\r\n\t\r\n\tPIXI.Container.prototype.addGlobalChild = function(...child: PIXI.DisplayObject[]) {\r\n\t\t//TODO: better to convert global position to current matrix\r\n\t\tthis.transform.updateLocalTransform();\r\n\t\tconst loc = new PIXI.Matrix();\r\n\t\tconst invert = this.transform.localTransform.clone().invert();\r\n\t\tfor (let i = 0; i < child.length; i++) {\r\n\r\n\t\t\tconst newChild = child[i];\r\n\t\t\tnewChild.transform.updateLocalTransform();\r\n\t\t\tloc.copyFrom(invert);\r\n\t\t\tloc.append(newChild.localTransform);\r\n\t\t\tchild[i].transform.setFromMatrix(loc);\r\n\t\t}\r\n\r\n\t\treturn this.addChild(...child);\r\n\t}\r\n}\r\n","\r\n\r\ndeclare module \"pixi.js\" {\r\n\texport interface DisplayObject {\r\n\t\treplaceWithTransform(from:DisplayObject): void\r\n\t}\r\n}\r\n\r\nexport default function(pack : {DisplayObject : any}) {\r\n\r\n\tif(!pack.DisplayObject)\r\n\t\tthrow new Error(\"Cant't find DisplayObject in package!\");\r\n\t\r\n\tpack.DisplayObject.prototype.replaceWithTransform = function(from: any) {\r\n        from.updateTransform();\r\n\r\n        if(from.parent){\r\n\t\t\tfrom.parent.addChildAt(this, from.parent.getChildIndex(from));\r\n\t\t}\r\n\r\n\t\tthis.pivot.copyFrom(from.pivot);        \r\n        this.position.copyFrom(from.position);\r\n\t\tthis.scale.copyFrom(from.scale);\r\n\t\tthis.rotation = from.rotation;\r\n\r\n        this.updateTransform();\r\n    }\r\n}","declare module \"pixi.js\" {\r\n\tnamespace utils {\r\n\t\texport interface EventEmitter {\r\n\t\t\tonceAsync(event: string, context? : any): Promise<any>;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default function(pack : {utils : any}) {\r\n\tif(!pack.utils)\r\n\t\tthrow new Error(\"Cant't find utils in package!\");\r\n\r\n    pack.utils.EventEmitter.prototype.onceAsync = function(event: string, context? : any) : Promise<any> {\r\n        return new Promise((res)=>{\r\n            this.once(event, res, context);\r\n        })\r\n    }\r\n}","import container from \"./ContainerExt\";\r\nimport display from \"./DisplayExt\";\r\nimport emitter from \"./EventEmitterExt\";\r\n \r\nexport function InjectMixins(pixiPackage : any) {\r\n    container(pixiPackage);\r\n    display(pixiPackage);\r\n    emitter(pixiPackage);\r\n}\r\n","import { ITiledLayer } from '../ITiledMap';\r\nimport { _prepareProperties, ApplyMeta } from '../tools/Utils';\r\nimport { Config } from '../Config';\r\nimport { TiledContainer} from './../objects/TiledContainer';\r\nimport { TilesetManager } from '../tools/TilesetManagers';\r\n\r\nexport interface ILayerBuilder {\r\n\tBuild(meta: ITiledLayer, tileset: TilesetManager, ...args: any[]): TiledContainer | undefined;\r\n};\r\n\r\nexport const LayerBuilder = {\r\n\tBuild(layer: ITiledLayer, tileset: TilesetManager, zOrder = 0): TiledContainer | undefined {\r\n\r\n\t\tconst useDisplay: boolean = !!Config.usePixiDisplay && (PIXI as any).display !== undefined;\r\n\t\tconst Layer = useDisplay ? (PIXI as any).display.Layer : {};\r\n\t\tconst Group = useDisplay ? (PIXI as any).display.Group : {};\r\n\r\n\t\t_prepareProperties(layer);\r\n\r\n\t\tconst props = layer.parsedProps;\r\n\r\n\t\tif (props.ignore || props.ignoreLoad) {\r\n\t\t\tconsole.log('[TILED] layer ignored:' + layer.name);\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tconst layerObject: TiledContainer = useDisplay\r\n\t\t\t? new Layer(new Group(props.zOrder !== undefined ? props.zOrder : zOrder, true))\r\n\t\t\t: new TiledContainer();\r\n\r\n\t\tlayerObject.tiledId = layer.id;\r\n\t\tlayerObject.name = layer.name;\r\n\t\tlayerObject.visible = layer.visible;\r\n\r\n\t\tlayerObject.position.set(layer.x, layer.y);\r\n\t\tlayerObject.alpha = layer.opacity || 1;\r\n\r\n\t\tApplyMeta(layer, layerObject);\r\n\t\treturn layerObject;\r\n\t},\r\n};\r\n","import { ITiledLayer, ITiledImageLayer, ITiledObjectLayer, ITiledSprite, ITiledObject } from '../ITiledMap';\r\nimport { TiledContainer } from '../objects/TiledContainer';\r\nimport { LayerBuilder } from './LayerBuilder';\r\nimport { TilesetManager } from '../tools/TilesetManagers';\r\nimport { _prepareProperties } from '../tools/Utils';\r\n\r\nimport * as SB from '../builders/SpriteBuilder';\r\nimport * as TB from '../builders/TextBuilder';\r\nimport * as CB from '../builders/ContainerBuilder';\r\n\r\nimport { TiledSprite } from '../objects/TiledSprite';\r\nimport { TiledObjectType, Objectype } from '../tools/TiledObjectType';\r\n\r\nexport const ObjectLayerBuilder = {\r\n\t__gen: <Record<TiledObjectType, (...args: any[]) => TiledContainer | TiledContainer>>{\r\n\t\t[TiledObjectType.IMAGE](meta: ITiledObject, tileset: TilesetManager) {\r\n\t\t\tconst smeta = meta as ITiledSprite;\r\n\t\t\tconst frame = smeta.image ? tileset.getTileByTile(smeta.image!) : tileset.getTileByGid(smeta.gid);\r\n\r\n\t\t\tsmeta.image = frame;\r\n\r\n\t\t\tconst sprite = SB.Build(smeta) as TiledSprite;\r\n\r\n\t\t\tif (smeta.fromImageLayer && frame!.lazyLoad) {\r\n\t\t\t\tframe!.texture.once('loaded', () => {\r\n\t\t\t\t\tsprite.scale.set(1);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (smeta.fromImageLayer) {\r\n\t\t\t\tsprite.anchor.set(0);\r\n\t\t\t}\r\n\r\n\t\t\treturn (sprite as any) as TiledContainer;\r\n\t\t},\r\n\t\t[TiledObjectType.TEXT](meta: ITiledObject, tileset: TilesetManager) {\r\n\t\t\treturn TB.Build(meta);\r\n\t\t},\r\n\t\t[TiledObjectType.DEFAULT](meta: ITiledObject, tileset: TilesetManager) {\r\n\t\t\treturn CB.Build(meta);\r\n\t\t},\r\n\t},\r\n\r\n\tBuild(layer: ITiledLayer, tileset: TilesetManager, zOrder = 0): TiledContainer | undefined {\r\n\t\tconst objLayer = layer as ITiledObjectLayer;\r\n\t\tconst layerContatiner = LayerBuilder.Build(layer, tileset, zOrder);\r\n\r\n\t\tif (!layerContatiner) {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tif (layer.type === 'imagelayer') {\r\n\t\t\tif (!this.__convertLayer(layer as ITiledImageLayer)) {\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!objLayer.objects || !objLayer.objects.length) {\r\n\t\t\treturn layerContatiner;\r\n\t\t}\r\n\r\n\t\tconst objects = objLayer.objects;\r\n\r\n\t\tlet localZIndex = 0;\r\n\r\n\t\tfor (let objMeta of objects) {\r\n\t\t\t_prepareProperties(objMeta);\r\n\r\n\t\t\tconst type = Objectype(objMeta);\r\n\t\t\tconst method = this.__gen[type] || this.__gen[TiledObjectType.DEFAULT];\r\n\t\t\tconst obj = method!.call(this, objMeta, tileset);\r\n\r\n\t\t\tif (!obj) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t/*\r\n\t\t\tif (Config.usePixiDisplay) {\r\n\t\t\t\t(obj as any).parentGroup = (layerContatiner as any).group;\r\n\t\t\t\tstage.addChildAt(pixiObject, localZIndex);\r\n\t\t\t} else {\r\n\t\t\t\t*/\r\n\r\n\t\t\tlayerContatiner.addChildAt(obj, localZIndex);\r\n\t\t\t//}\r\n\r\n\t\t\tlocalZIndex++;\r\n\t\t}\r\n\r\n\t\treturn layerContatiner;\r\n\t},\r\n\r\n\t__convertLayer(imageLayer: ITiledImageLayer) {\r\n\t\tif (!imageLayer.image) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t(imageLayer as any).objects = [\r\n\t\t\t{\r\n\t\t\t\timage: {\r\n\t\t\t\t\timage: imageLayer.image,\r\n\t\t\t\t},\r\n\t\t\t\t//imageLayer can't has gid ID\r\n\r\n\t\t\t\tgid: -1,\r\n\t\t\t\tname: imageLayer.name,\r\n\t\t\t\tx: imageLayer.x + imageLayer.offsetx,\r\n\t\t\t\ty: imageLayer.y + imageLayer.offsety,\r\n\r\n\t\t\t\tfromImageLayer: true,\r\n\t\t\t\tproperties: imageLayer.properties,\r\n\t\t\t\tparsedProps: imageLayer.parsedProps,\r\n\t\t\t} as ITiledSprite,\r\n\t\t];\r\n\r\n\t\treturn true;\r\n\t},\r\n};\r\n","import { ITiledLayer, ITiledTileLayer, ITiledMap, ITiledTile, ITiledSprite } from '../ITiledMap';\r\nimport { TilesetManager } from '../tools/TilesetManagers';\r\nimport { LayerBuilder } from './LayerBuilder';\r\nimport { TiledMapContainer } from '../objects/TiledMapContainer';\r\nimport { TiledSprite } from '../objects/TiledSprite';\r\nimport { Config } from '../Config';\r\nimport { TiledContainer } from '../index';\r\nimport { TileAnimator } from '../objects/TiledAnimator';\r\n\r\nexport const TiledLayerBuilder = {\r\n\tBuild(layer: ITiledLayer, set: TilesetManager, zOrder: number = 0, tileMap: TiledMapContainer) {\r\n\t\tconst tiledLayer = layer as ITiledTileLayer;\r\n\t\tconst tileMapSource: ITiledMap = tileMap.source! as ITiledMap;\r\n\t\tconst layerContatiner = LayerBuilder.Build(layer, set, zOrder) as TiledContainer & {animators: Map<string, TileAnimator> };\r\n\r\n\t\tif(!layerContatiner) {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\r\n\t\tconst data = this.__decodeData(tiledLayer);\r\n\t\tconst { width, height } = layer;\r\n\t\tconst { tileheight, tilewidth } = tileMapSource;\r\n\r\n\t\tconst genTile = (x: number, y: number, gid: number)=>{\r\n\t\t\tconst tile = set.getTileByGid(gid);\r\n\r\n\t\t\tconst s = new TiledSprite({\r\n\t\t\t\timage: tile,\r\n\t\t\t\tfromImageLayer: false,\r\n\t\t\t\tgid: gid,\r\n\t\t\t\tanchor: {x: 0, y: 0}\r\n\t\t\t} as ITiledSprite);\r\n\t\t\t\r\n\t\t\ts.x = x * tilewidth;\r\n\t\t\ts.y = y * tileheight;\r\n\t\t\ts.roundPixels = Config.roundPixels;\r\n\r\n\t\t\tif(tile && tile.animation) {\r\n\t\t\t\tconst animators = layerContatiner.animators || new Map();\r\n\t\t\t\tconst animId = tile.tilesetId + \"_\" + tile.id;\r\n\r\n\t\t\t\tlet animator = animators.get(animId);\r\n\t\t\t\tif(!animator) {\r\n\t\t\t\t\tanimator = new TileAnimator(tile);\r\n\t\t\t\t\tanimators.set(animId, animator);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ts.anim = animator;\r\n\t\t\t\tanimator.anim.play();\r\n\t\t\t}\r\n\r\n\t\t\treturn s;\r\n\t\t}\r\n\r\n\t\tfor (let y = 0; y < height; y++) {\r\n\t\t\tfor (let x = 0; x < width; x++) {\r\n\t\t\t\tconst index = x + y * width;\r\n\t\t\t\tconst gid = data[index];\r\n\r\n\t\t\t\t// skip gid 0,\r\n\t\t\t\tif(!gid) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlayerContatiner.addChild(genTile(x,y,data[index]));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn layerContatiner;\r\n\t},\r\n\r\n\t__decodeData(layer: ITiledTileLayer): number[] {\r\n\t\treturn layer.data;\r\n\t},\r\n};\r\n","declare global {\r\n\tinterface Window {\r\n\t\tPIXI: any;\r\n\t}\r\n}\r\n\r\nconst VERSION = '__VERSION__';\r\n\r\nimport * as ContainerBuilder from './builders/ContainerBuilder';\r\nimport * as SpriteBuilder from './builders/SpriteBuilder';\r\nimport * as TextBuilder from './builders/TextBuilder';\r\n\r\nimport { Parser, CreateStage } from './tools/TiledObjectParser';\r\nimport { Config, ITiledProps, LayerBuildersMap } from './Config';\r\nimport { TiledContainer } from './objects/TiledContainer';\r\nimport { InjectMixins } from './pixi-utils';\r\n\r\n// prevent circular\r\nObject.assign(LayerBuildersMap, {\r\n\ttilelayer: TiledLayerBuilder,\r\n\tobjectgroup: ObjectLayerBuilder,\r\n\timagelayer: ObjectLayerBuilder,\r\n\tgroup: undefined,\r\n});\r\n\r\nexport function Inject(pixiPack = window.PIXI, props: Partial<ITiledProps> | undefined = undefined) {\r\n\tif (!pixiPack) {\r\n\t\tconsole.warn(\r\n\t\t\t\"Auto injection works only with globals scoped PIXI, not in modules\\nuse 'Loader.registerPlugin(Parser)' otherwith\",\r\n\t\t);\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (props) {\r\n\t\tObject.assign(Config, props);\r\n\t}\r\n\r\n\tInjectMixins(pixiPack);\r\n\r\n\tif (Config.injectMiddleware) {\r\n\t\tpixiPack.Loader.registerPlugin(Parser);\r\n\t}\r\n}\r\n\r\nimport * as Primitives from './objects/TiledPrimitives';\r\nimport { MultiSpritesheet } from './tools/TiledMultiSheet';\r\nimport { ObjectLayerBuilder } from './layers/ObjectsLayerBuilder';\r\nimport { TiledLayerBuilder } from './layers/TiledLayerBuilder';\r\nexport { Primitives };\r\nexport { Parser };\r\nexport { CreateStage };\r\nexport { Config };\r\nexport { ContainerBuilder };\r\nexport { SpriteBuilder };\r\nexport { TextBuilder };\r\nexport { TiledContainer };\r\nexport { MultiSpritesheet };\r\nexport { VERSION };\r\n"],"names":["Build","Utils.HexStringToHexInt","PIXI.Container","PIXI.Matrix","SB.Build","TB.Build","CB.Build"],"mappings":"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"}